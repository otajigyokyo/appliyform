<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è²·å‡ºäººç« äº¤ä»˜ç”³è«‹ãƒ•ã‚©ãƒ¼ãƒ </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 3px solid #4285f4;
            padding-bottom: 20px;
        }

        .header h1 {
            color: #4285f4;
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .required {
            color: #e74c3c;
            font-size: 0.9em;
            margin-left: 5px;
        }

      /* æ—¥ä»˜å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èª¿æ•´ */
        input[type="date"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            color: #000;
            letter-spacing: 0.3px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-color: white;
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', sans-serif;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            font-weight: 600;
            color: #000;
            letter-spacing: 0.3px;
        }

        .form-control:focus {
            outline: none;
            border-color: #4285f4;
            box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }


/* æ—¥ä»˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰(readonly)ã®ã‚¹ã‚¿ã‚¤ãƒ« */
input[type="date"][readonly] {
    background-color: #f8f9fa;
    cursor: not-allowed;
    color: #495057;
}

/* ã‚¹ãƒãƒ›å¯¾å¿œ */
@media (max-width: 768px) {
    input[type="date"][readonly] {
        background-color: #f8f9fa;
        cursor: not-allowed;
    }
}


        .btn-container {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #eee;
        }

        .btn {
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .btn-primary {
            background-color: #4285f4;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: #3367d6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #545b62;
        }

        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.6;
        }

        /* ========== ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºï¼ˆç›®ç«‹ã¤ç‰ˆï¼‰ ========== */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-content {
            background: white;
            padding: 40px 60px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .spinner-large {
            display: inline-block;
            width: 60px;
            height: 60px;
            border: 5px solid #e0e0e0;
            border-top: 5px solid #4285f4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .loading-subtext {
            font-size: 14px;
            color: #666;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* æ—§ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰ */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4285f4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .message {
            padding: 15px;
            margin: 20px 0;
            border-radius: 6px;
            display: none;
        }

        .message.success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .message.error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        /* ========== æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆå¤§ããç›®ç«‹ã¤ç‰ˆï¼‰ ========== */
        .success-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .success-overlay.show {
            display: flex;
        }

        .success-content {
            background: white;
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .success-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .success-title {
            font-size: 24px;
            font-weight: bold;
            color: #28a745;
            margin-bottom: 15px;
        }

        .success-member-id {
            font-size: 18px;
            color: #333;
            margin-bottom: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .success-payment-notice {
            background: #e8f5e9;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .success-payment-notice h4 {
            color: #155724;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .success-payment-notice p {
            color: #155724;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .success-payment-notice .email-subject {
            background: #fff;
            padding: 8px 12px;
            border-radius: 4px;
            font-weight: bold;
            display: inline-block;
            margin: 5px 0;
        }

        .success-close-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 15px;
        }

        .success-close-btn:hover {
            background: #3367d6;
        }

        .note {
            background-color: #e7f3ff;
            border: 1px solid #bee5eb;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
            font-size: 0.95em;
            color: #0c5460;
        }

        .warning-note {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-size: 0.9em;
            color: #856404;
        }

        .warning-note ul {
            margin: 10px 0 0 20px;
        }

        .warning-note li {
            margin: 5px 0;
        }

        /* è¦ç´„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .terms-section {
            background-color: #fff9e6;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin: 30px 0;
        }

        .terms-section h2 {
            color: #856404;
            font-size: 1.5em;
            margin-bottom: 15px;
            text-align: center;
        }

        .terms-content {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            font-size: 0.95em;
            line-height: 1.8;
        }

        .terms-content h3 {
            color: #4285f4;
            font-size: 1.2em;
            margin: 20px 0 10px 0;
            border-bottom: 2px solid #4285f4;
            padding-bottom: 5px;
        }

        .terms-content h3:first-child {
            margin-top: 0;
        }

        .terms-content section {
            margin-bottom: 25px;
        }

        .terms-content section h4 {
            color: #333;
            font-size: 1.1em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .terms-content p {
            margin-bottom: 10px;
            text-align: justify;
        }

        .terms-content ul {
            margin: 10px 0 10px 25px;
        }

        .terms-content li {
            margin: 8px 0;
        }

        .terms-agreement {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border: 2px solid #dee2e6;
        }

        .terms-agreement input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
        }

        .terms-agreement label {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            margin: 0;
        }

        .terms-agreement.checked {
            background-color: #d4edda;
            border-color: #28a745;
        }

        .terms-agreement.checked label {
            color: #155724;
        }

        /* â˜…è¿½åŠ : è¦ç´„ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¿…é ˆã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .terms-agreement.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .terms-agreement.disabled label {
            color: #999;
        }

        .scroll-hint {
            text-align: center;
            padding: 12px;
            background-color: #fff3cd;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 14px;
            color: #856404;
            display: block;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        .scroll-hint.hidden {
            display: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ */
        .file-upload-section {
            background-color: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 25px 0;
            text-align: center;
        }

        .file-upload-section h3 {
            color: #495057;
            margin-bottom: 10px;
        }

        .file-upload-section p {
            color: #6c757d;
            margin-bottom: 15px;
        }

        .file-upload-input {
            display: none;
        }

        .file-upload-button {
            background-color: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: background-color 0.3s ease;
        }

        .file-upload-button:hover {
            background-color: #218838;
        }

        /* â˜…è¿½åŠ : ã‚«ãƒ¡ãƒ©ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒœã‚¿ãƒ³ */
        .upload-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .file-upload-button.camera-btn {
            background-color: #2196F3;
        }

        .file-upload-button.camera-btn:hover {
            background-color: #1976D2;
        }

        .file-preview {
            margin-top: 15px;
            display: none;
        }

        .file-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .file-info {
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }

        /* ãƒˆãƒªãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .crop-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }

        .crop-modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 20px;
            width: 90%;
            max-width: 800px;
            border-radius: 8px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .crop-container {
            max-height: 500px;
            margin: 20px 0;
        }

        .crop-container img {
            max-width: 100%;
        }

        .crop-buttons {
            text-align: center;
            margin-top: 20px;
        }

        .crop-info {
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background-color: #e3f2fd;
            border-radius: 4px;
            font-size: 14px;
            color: #1976d2;
        }

        /* â˜…è¿½åŠ : æœˆé¡æ‰‹æ•°æ–™ã®æ³¨æ„æ›¸ã */
        .fee-notice {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border: 3px solid #ff9800;
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        }

        .fee-notice-icon {
            font-size: 40px;
            flex-shrink: 0;
        }

        .fee-notice-content {
            flex: 1;
        }

        .fee-notice-title {
            font-size: 14px;
            color: #e65100;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .fee-notice-amount {
            font-size: 28px;
            font-weight: bold;
            color: #d84315;
            margin-bottom: 5px;
        }

        .fee-notice-desc {
            font-size: 13px;
            color: #bf360c;
        }

        /* ========== ã‚¹ãƒãƒ›å¯¾å¿œï¼ˆ768pxä»¥ä¸‹ï¼‰ - GitHub Pagesç”¨ ========== */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                font-size: 16px;
            }
            
            .container {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.4em;
            }

            .header .subtitle {
                font-size: 14px;
            }

            .form-group label {
                font-size: 14px;
                margin-bottom: 8px;
            }

            .required {
                font-size: 12px;
            }

            .form-control {
                font-size: 16px; /* iOSè‡ªå‹•ã‚ºãƒ¼ãƒ é˜²æ­¢ã®ãŸã‚16pxä»¥ä¸Š */
                padding: 12px 15px;
                font-weight: 600;
                color: #000;
                letter-spacing: 0.3px;
            }

            textarea.form-control {
                min-height: 80px;
            }
            
            /* ç¸¦ä¸¦ã³ã«å¤‰æ›´ */
            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .form-row .form-group {
                width: 100%;
            }
            
            .btn {
                width: 100%;
                margin: 10px 0;
                padding: 14px 20px;
                font-size: 16px;
            }

            input[type="date"] {
                font-size: 16px;
                padding: 12px 15px;
                font-weight: 600;
                color: #000;
                letter-spacing: 0.3px;
                line-height: 1.2;
                min-height: 44px;
            }

            .note {
                font-size: 13px;
                padding: 12px;
            }

            .warning-note {
                font-size: 13px;
                padding: 12px;
            }

            .terms-section h2 {
                font-size: 18px;
            }

            .terms-content {
                font-size: 13px;
                padding: 12px;
                max-height: 200px;
            }

            .terms-content h3 {
                font-size: 15px;
            }

            .terms-content section h4 {
                font-size: 14px;
            }

            .terms-agreement {
                padding: 12px;
            }

            .terms-agreement input[type="checkbox"] {
                width: 20px;
                height: 20px;
                margin-right: 10px;
            }

            .terms-agreement label {
                font-size: 14px;
            }

            .file-upload-section h3 {
                font-size: 15px;
            }

            .file-upload-section p {
                font-size: 13px;
            }

            .file-upload-button {
                font-size: 14px;
                padding: 12px 20px;
            }

            .file-info {
                font-size: 13px;
            }

            .crop-modal-content {
                width: 95%;
                margin: 5% auto;
                padding: 15px;
            }

            .crop-modal-content h2 {
                font-size: 18px;
            }

            .crop-info {
                font-size: 13px;
                padding: 10px;
            }

            .message {
                font-size: 14px;
                padding: 12px;
            }

            .loading {
                font-size: 14px;
            }

            .spinner {
                width: 30px;
                height: 30px;
                border-width: 3px;
            }

            /* ã‚¹ãƒãƒ›ç”¨ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°èª¿æ•´ */
            .loading-content {
                padding: 20px 25px;
            }

            .spinner-large {
                width: 50px;
                height: 50px;
                border-width: 4px;
            }

            .loading-text {
                font-size: 18px;
            }

            .loading-subtext {
                font-size: 14px;
            }

            /* ã‚¹ãƒãƒ›ç”¨æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸èª¿æ•´ */
            .success-content {
                padding: 20px;
            }

            .success-icon {
                font-size: 50px;
            }

            .success-title {
                font-size: 18px;
            }

            .success-member-id {
                font-size: 14px;
            }

            .success-payment-notice h4 {
                font-size: 14px;
            }

            .success-payment-notice p {
                font-size: 13px;
            }

            .success-close-btn {
                font-size: 16px;
                padding: 12px 30px;
            }

            /* â˜…ã‚¹ãƒãƒ›ç”¨ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ */
            .upload-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .upload-buttons .file-upload-button {
                width: 90%;
                margin: 6px 0;
            }

            /* â˜…ã‚¹ãƒãƒ›ç”¨æœˆé¡æ‰‹æ•°æ–™ */
            .fee-notice {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .fee-notice-amount {
                font-size: 24px;
            }

            .scroll-hint {
                font-size: 13px;
                padding: 10px;
            }
        }

        /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå¯¾å¿œï¼ˆ769pxã€œ1024pxï¼‰ */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                max-width: 700px;
            }
            
            .form-control {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner-large"></div>
            <div class="loading-text">é€ä¿¡ä¸­...</div>
            <div class="loading-subtext">ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„</div>
        </div>
    </div>

    <!-- æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div class="success-overlay" id="successOverlay">
        <div class="success-content">
            <div class="success-icon">âœ…</div>
            <div class="success-title">ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸ</div>
            <div class="success-member-id" id="successMemberId"></div>
            
            <div class="success-payment-notice">
                <h4>ğŸ’³ ãŠæ”¯æ‰•ã„ã®ç™»éŒ²ã«ã¤ã„ã¦</h4>
                <p>åˆ¥é€”ã€æ”¯æ‰•ã„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚ˆã‚Šä»¥ä¸‹ã®ä»¶åã§ãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚</p>
                <div class="email-subject">ã€å¤§ç”°å¸‚å ´èŠ±ãäº‹æ¥­å”åŒçµ„åˆã€‘æ±ºæ¸ˆæ–¹æ³•ç™»éŒ²URLã®ã”æ¡ˆå†…</div>
                <p>ãã®ãƒ¡ãƒ¼ãƒ«ã«è¨˜è¼‰ã®URLã‹ã‚‰ã€ãŠæ”¯æ‰•ã„æ–¹æ³•ã®ç™»éŒ²ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</p>
                <p style="color: #d84315; background: #fff3e0; padding: 10px; border-radius: 4px; margin-top: 10px; font-weight: bold;">
                    ğŸ’° è³‡æ ¼ç¶­æŒæ‰‹æ•°æ–™ï¼šæœˆé¡800å††ï¼ˆç¨è¾¼ï¼‰ãŒæ¯æœˆè‡ªå‹•æ±ºæ¸ˆã•ã‚Œã¾ã™
                </p>
                <p style="color: #856404; background: #fff3cd; padding: 8px; border-radius: 4px; margin-top: 10px;">
                    â€»ãŠæ”¯æ‰•ã„ç™»éŒ²ãŒå®Œäº†ã™ã‚‹ã¾ã§ã€è²·å‡ºäººç« ã®ç™ºè¡ŒãŒã§ãã¾ã›ã‚“
                </p>
            </div>
            
            <button class="success-close-btn" onclick="closeSuccessOverlay()">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>è²·å‡ºäººç« äº¤ä»˜ç”³è«‹ãƒ•ã‚©ãƒ¼ãƒ </h1>
            <div class="subtitle">å¿…è¦äº‹é …ã‚’ã”å…¥åŠ›ã®ä¸Šã€é€ä¿¡ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
        </div>

        <div class="note">
            <strong>æ³¨æ„äº‹é …ï¼š</strong>
            å¿…é ˆé …ç›®ã¯å¿…ãšã”å…¥åŠ›ãã ã•ã„ã€‚ãµã‚ŠãŒãªã¯æ‰‹å‹•ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
        </div>

        <form id="applicationForm">
            <!-- æ—¥ä»˜ -->
            <div class="form-group">
              <label for="date">æ—¥ä»˜ <span class="required">*å¿…é ˆ</span></label>
              <input type="date" id="date" name="date" class="form-control" required readonly>
            </div>

            <!-- åº—å -->
            <div class="form-row">
                <div class="form-group">
                    <label for="shopName">åº—å <span class="required">*å¿…é ˆ</span></label>
                    <input type="text" id="shopName" name="shopName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="shopNameFurigana">åº—åï¼ˆãµã‚ŠãŒãªï¼‰ <span class="required">*å¿…é ˆ</span></label>
                    <input type="text" id="shopNameFurigana" name="shopNameFurigana" class="form-control" required placeholder="ãµã‚ŠãŒãªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                </div>
            </div>

            <!-- ä»£è¡¨è€…å -->
            <div class="form-row">
                <div class="form-group">
                    <label for="representativeName">ä»£è¡¨è€…å <span class="required">*å¿…é ˆ</span></label>
                    <input type="text" id="representativeName" name="representativeName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="representativeNameFurigana">ä»£è¡¨è€…åï¼ˆãµã‚ŠãŒãªï¼‰ <span class="required">*å¿…é ˆ</span></label>
                    <input type="text" id="representativeNameFurigana" name="representativeNameFurigana" class="form-control" required placeholder="ãµã‚ŠãŒãªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                </div>
            </div>

            <!-- è²·å‡ºäººç« ç€ç”¨è€…æ°å -->
            <div class="form-row">
                <div class="form-group">
                    <label for="wearerName">è²·å‡ºäººç« ç€ç”¨è€…æ°å <span class="required">*å¿…é ˆ</span></label>
                    <input type="text" id="wearerName" name="wearerName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="wearerNameFurigana">è²·å‡ºäººç« ç€ç”¨è€…æ°åï¼ˆãµã‚ŠãŒãªï¼‰ <span class="required">*å¿…é ˆ</span></label>
                    <input type="text" id="wearerNameFurigana" name="wearerNameFurigana" class="form-control" required placeholder="ãµã‚ŠãŒãªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
                </div>
            </div>

            <!-- éƒµä¾¿ç•ªå·ãƒ»ä½æ‰€ -->
            <div class="form-row">
                <div class="form-group" style="flex: 0 0 200px;">
                    <label for="postalCode">éƒµä¾¿ç•ªå· <span class="required">*å¿…é ˆ</span></label>
                    <input type="text" id="postalCode" name="postalCode" class="form-control" placeholder="000-0000" required inputmode="numeric" pattern="[0-9-]*">
                </div>
                <div class="form-group">
                    <label for="address">ä½æ‰€ <span class="required">*å¿…é ˆ</span></label>
                    <input type="text" id="address" name="address" class="form-control" placeholder="éƒµä¾¿ç•ªå·ã‹ã‚‰ä½æ‰€ãŒå…¥åŠ›ã•ã‚Œã¾ã™" required>
                </div>
            </div>

            <!-- é›»è©±ãƒ»FAX -->
            <div class="form-row">
                <div class="form-group">
                    <label for="phone">é›»è©± <span class="required">*å¿…é ˆ</span></label>
                    <input type="tel" id="phone" name="phone" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="fax">FAX</label>
                    <input type="tel" id="fax" name="fax" class="form-control">
                </div>
            </div>

            <!-- é€£çµ¡å…ˆé›»è©± -->
            <div class="form-group">
                <label for="contactPhone">é€£çµ¡å…ˆé›»è©±</label>
                <input type="tel" id="contactPhone" name="contactPhone" class="form-control">
            </div>

            <!-- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹è¿½åŠ  -->
            <div class="form-group">
              <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span class="required">*å¿…é ˆ</span></label>
              <input type="email" id="email" name="email" class="form-control" required placeholder="example@example.com" inputmode="email" autocapitalize="off" autocomplete="email">
            </div>

            <!-- æ¥­æ…‹ãƒ»ä¸»ãªè²©å£²å…ˆ -->
            <div class="form-row">
                <div class="form-group">
                    <label for="businessType">æ¥­æ…‹ <span class="required">*å¿…é ˆ</span></label>
                    <input type="text" id="businessType" name="businessType" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="mainCustomers">ä¸»ãªè²©å£²å…ˆ</label>
                    <input type="text" id="mainCustomers" name="mainCustomers" class="form-control">
                </div>
            </div>

            <!-- å‚™è€ƒ -->
            <div class="form-group">
                <label for="remarks">å‚™è€ƒ</label>
                <textarea id="remarks" name="remarks" class="form-control" rows="4" placeholder="ãã®ä»–ã”é€£çµ¡äº‹é …ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã”è¨˜å…¥ãã ã•ã„"></textarea>
            </div>

            <!-- â˜…ä¿®æ­£: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰1: ç”³è«‹è€…æœ¬äººã®é¡”å†™çœŸï¼ˆã‚«ãƒ¡ãƒ©æ©Ÿèƒ½è¿½åŠ ï¼‰ -->
            <div class="file-upload-section">
                <h3>ç”³è«‹è€…æœ¬äººã®é¡”å†™çœŸ <span class="required">*å¿…é ˆ</span></h3>
                <p>è¨¼æ˜å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„<br>
                <small>ç¸¦35mm Ã— æ¨ª25mmã‚µã‚¤ã‚ºã«ãƒˆãƒªãƒŸãƒ³ã‚°ã•ã‚Œã¾ã™</small></p>
                <input type="file" id="photoUpload" name="photoUpload" class="file-upload-input" accept="image/*" onchange="handlePhotoSelect(event)">
                <input type="file" id="photoCamera" name="photoCamera" class="file-upload-input" accept="image/*" capture="user" onchange="handlePhotoSelect(event)">
                <div class="upload-buttons">
                    <button type="button" class="file-upload-button" onclick="document.getElementById('photoUpload').click()">
                        ğŸ“ å†™çœŸã‚’é¸æŠ
                    </button>
                    <button type="button" class="file-upload-button camera-btn" onclick="document.getElementById('photoCamera').click()">
                        ğŸ“· ã‚«ãƒ¡ãƒ©ã§æ’®å½±
                    </button>
                </div>
                <div class="file-preview" id="photoPreview"></div>
            </div>

            <!-- â˜…ä¿®æ­£: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰2: èŠ±ãæ¥­ã®å…¬çš„æ›¸é¡ï¼ˆã‚«ãƒ¡ãƒ©æ©Ÿèƒ½è¿½åŠ ï¼‰ -->
            <div class="file-upload-section">
                <h3>èŠ±ãæ¥­ã®è¨˜è¼‰ã®ã‚ã‚‹å…¬çš„æ›¸é¡ã€ã©ã‚Œã‹ä¸€ã¤ <span class="required">*å¿…é ˆ</span></h3>
                <p>èŠ±ãæ¥­ãŒç¢ºèªã§ãã‚‹å…¬çš„æ›¸é¡ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„</p>
                <div class="warning-note">
                    <strong>æ³¨æ„äº‹é …ï¼š</strong>
                    <ul>
                        <li>èŠ±ãæ¥­ã®è¨˜è¼‰ãŒã‚ã‚‹ä¸‹è¨˜æ›¸é¡ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„</li>
                        <li>ç¨å‹™ç½²å—ä»˜æ¸ˆã¿ã®æ‰€å¾—ç”³å‘Šæ›¸ã€ç´ç¨è¨¼æ˜ã€ä¼šç¤¾è¬„æœ¬ã€åº—èˆ—å¥‘ç´„æ›¸å†™ã—ã€é–‹æ¥­å±Šå‡ºæ›¸å†™ã—ç­‰ã€å…¬çš„ã«åˆ¤æ–­ã§ãã‚‹ã‚‚ã®</li>
                        <li><strong>ä¸å¯ã®ä¾‹ï¼š</strong>ãƒ•ãƒ©ãƒ¯ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³æ•™å®¤ã®ãƒãƒ©ã‚·ã‚„åº—èˆ—å†™çœŸã€ååˆºã®ã¿ã¯ä¸å¯ã§ã™</li>
                    </ul>
                </div>
                <input type="file" id="documentUpload" name="documentUpload" class="file-upload-input" accept="image/*,.pdf" onchange="handleDocumentSelect(event)">
                <input type="file" id="documentCamera" name="documentCamera" class="file-upload-input" accept="image/*" capture="environment" onchange="handleDocumentSelect(event)">
                <div class="upload-buttons">
                    <button type="button" class="file-upload-button" onclick="document.getElementById('documentUpload').click()">
                        ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
                    </button>
                    <button type="button" class="file-upload-button camera-btn" onclick="document.getElementById('documentCamera').click()">
                        ğŸ“· ã‚«ãƒ¡ãƒ©ã§æ’®å½±
                    </button>
                </div>
                <div class="file-preview" id="documentPreview"></div>
            </div>

            <!-- è¦ç´„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="terms-section">
                <h2>ğŸ“œ è²·å‡ºäººç« è¦ç´„</h2>
                <div class="terms-content" id="termsContent">
                    <h3>å¤§ç”°å¸‚å ´èŠ±ãäº‹æ¥­å”åŒçµ„åˆï¼ˆãƒãƒŠãƒ¡ã‚»ãƒŠï¼‰</h3>

                    <section id="art1">
                        <h4>ç¬¬1æ¡ã€€è²·å‡ºäººç« ã®å®šç¾©</h4>
                        <p>ã€Œè²·å‡ºäººç« ã€ã¨ã¯ã€å¸‚å ´æ§‹å†…ã«ãŠã„ã¦ç”ŸèŠ±ãƒ»ä»²å¸æ¥­è€…ãƒ»é–¢é€£æ¥­è€…ã‹ã‚‰å•†å“ã‚’è³¼å…¥ã™ã‚‹ãŸã‚ã®è¨¼ç« ã§ã‚ã‚Šã€ä¸€èˆ¬ã®å¸‚å ´è¦‹å­¦è€…ã‚„ä¸å¯©å…¥å ´è€…ã¨åŒºåˆ¥ã™ã‚‹ãŸã‚ã«ä½œæˆã•ã‚ŒãŸã‚‚ã®ã§ã™ã€‚</p>
                    </section>

                    <section id="art2">
                        <h4>ç¬¬2æ¡ã€€æºè¡Œç¾©å‹™</h4>
                        <p>èŠ±ãéƒ¨å†…ã§ã¯ã€å¸¸æ™‚é¦–ã‹ã‚‰ä¸‹ã’ã¦æºè¡Œã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚</p>
                    </section>

                    <section id="art3">
                        <h4>ç¬¬3æ¡ã€€å–å¾—è³‡æ ¼</h4>
                        <p>ã€Œè²·å‡ºäººç« ã€ã®å–å¾—è³‡æ ¼ã¯ã€èŠ±ããŠã‚ˆã³é–¢é€£è³‡æã®å–æ‰±ã„ã«å¾“äº‹ã—ã¦ã„ã‚‹æ–¹ã«é™ã‚Šã¾ã™ã€‚</p>
                    </section>

                    <section id="art4">
                        <h4>ç¬¬4æ¡ã€€è³‡æ ¼ã®å€‹äººæ€§ãŠã‚ˆã³è­²æ¸¡ç¦æ­¢</h4>
                        <p>ã€Œè²·å‡ºäººç« ã€ã¯å€‹äººè³‡æ ¼ã§ã‚ã‚Šã€ç¬¬ä¸‰è€…ã¸ã®è²¸ä¸ãƒ»è­²æ¸¡ãƒ»å£²è²·ãƒ»è³ªå…¥ã‚Œã€ãã®ä»–ã„ã‹ãªã‚‹å‡¦åˆ†ã‚‚ç¦æ­¢ã—ã¾ã™ã€‚</p>
                    </section>

                    <section id="art5">
                        <h4>ç¬¬5æ¡ã€€æºè¡Œã—ãªã„è€…ã®åˆ¶é™</h4>
                        <p>ã€Œè²·å‡ºäººç« ã€ã‚’æºè¡Œã—ãªã„è€…ã¯ã€èŠ±ãéƒ¨ä»²å¸å£²å ´ãŠã‚ˆã³èŠ±ãé–¢é€£å•†å”åŒçµ„åˆåŠ ç›Ÿåº—ã§å•†å“ã‚’è³¼å…¥ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚</p>
                    </section>

                    <section id="art6">
                        <h4>ç¬¬6æ¡ã€€è³‡æ ¼ã®åœæ­¢ãƒ»è§£é™¤</h4>
                        <p>ã€Œè²·å‡ºäººç« ã€æºè¡Œè€…ãŒå¤§ç”°å¸‚å ´èŠ±ãéƒ¨ã®å ´å†…ãƒ«ãƒ¼ãƒ«ã«é‡å¤§ãªé•åã‚’ã—ãŸå ´åˆã¯ã€ãã®è³‡æ ¼ã‚’åœæ­¢ã¾ãŸã¯è§£é™¤ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚å ´å†…ãƒ«ãƒ¼ãƒ«ã¯å¿…ãšå³å®ˆã—ã¦ãã ã•ã„ã€‚</p>
                    </section>

                    <section id="art7">
                        <h4>ç¬¬7æ¡ã€€è³‡æ ¼ç¶­æŒè²»ç”¨ãŠã‚ˆã³å†ç™ºè¡Œãƒ»ç™»éŒ²å¤‰æ›´</h4>
                        <ul>
                            <li>ã€Œè²·å‡ºäººç« ã€ç™ºè¡Œæ™‚ã‹ã‚‰æ¯æœˆ800å††ã®è³‡æ ¼ç¶­æŒæ‰‹æ•°æ–™ã‚’å¾´åã—ã€å½“è©²æ‰‹æ•°æ–™ã‚’ãŠæ”¯æ‰•ã„ã„ãŸã ã„ã¦ã„ã‚‹æœŸé–“ä¸­ã¯ã€æ›´æ–°æ‰‹ç¶šããªãè³‡æ ¼ã‚’ç¶­æŒã§ãã¾ã™ã€‚</li>
                            <li>ç´›å¤±æ™‚ã®å†ç™ºè¡Œæ‰‹æ•°æ–™ã¯1,500å††ã¨ã—ã€ãƒãƒŠãƒ¡ã‚»ãƒŠçª“å£ã«ã¦ç¾é‡‘ã§ãŠæ”¯æ‰•ã„ãã ã•ã„ã€‚</li>
                            <li>è²·å‡ºäººã®æ‹…å½“è€…å¤‰æ›´ã€ã¾ãŸã¯åº—èˆ—åã®å¤‰æ›´ãŒã‚ã‚‹å ´åˆã¯ã€æ”¹ã‚ã¦æ–°è¦ç™»éŒ²ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚</li>
                        </ul>
                    </section>

                    <section id="art8">
                        <h4>ç¬¬8æ¡ã€€è³‡æ ¼ã®è§£é™¤</h4>
                        <p>è²·å‡ºäººè³‡æ ¼ã‚’è§£é™¤ã™ã‚‹å ´åˆã¯ã€å¤§ç”°å¸‚å ´èŠ±ãäº‹æ¥­å”åŒçµ„åˆï¼ˆãƒãƒŠãƒ¡ã‚»ãƒŠï¼‰ã¸ã®æ›¸é¢ã«ã‚ˆã‚‹ç”³è«‹ã€ã¾ãŸã¯å¾´åä»£è¡Œæ¥­è€…ï¼ˆä¼šè²»ãƒšã‚¤ï¼‰ã§ã®æ‰‹ç¶šãã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚è§£é™¤ã‹ã‚‰è²»ç”¨å¾´ååœæ­¢ã¾ã§ã®æœŸé–“ã¯ã€ä¼šè²»ãƒšã‚¤ã®è¦ç´„ã«å¾“ã†ã‚‚ã®ã¨ã—ã¾ã™ã€‚</p>
                    </section>

                    <section id="art9">
                        <h4>ç¬¬9æ¡ã€€ç„¡åŠ¹è²·å‡ºäººç« ä½¿ç”¨ã®ç¦æ­¢</h4>
                        <p>ä»²å¸ç­‰ã«ã¦è²·å‡ºäººç« ã®ç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚è³‡æ ¼ã®ãªã„è€…ã«ã‚ˆã‚‹ç„¡åŠ¹ãªè²·å‡ºäººç« ã®ä½¿ç”¨ã‚’ç¦æ­¢ã—ã¾ã™ã€‚</p>
                    </section>

                    <section id="art10">
                        <h4>ç¬¬10æ¡ã€€å€‹äººæƒ…å ±ã®å–æ‰±ã„</h4>
                        <p>ç™»éŒ²æ™‚ã«ã„ãŸã ãå€‹äººãŠã‚ˆã³åº—èˆ—æƒ…å ±ã¯ã€å¤§ç”°å¸‚å ´èŠ±ãäº‹æ¥­å”åŒçµ„åˆã€ä»²å¸çµ„åˆã€è³‡æé–¢é€£å›£ä½“ã§å…±æœ‰ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®æƒ…å ±ã¯è²©å£²ä¿ƒé€²ç­‰ã®æ­£å½“ãªæ¥­å‹™ç›®çš„ä»¥å¤–ã«ã¯ä½¿ç”¨ã„ãŸã—ã¾ã›ã‚“ã€‚</p>
                    </section>
                </div>

                <!-- â˜…è¿½åŠ : ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä¿ƒé€²ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                <div class="scroll-hint" id="scrollHint">
                    â¬‡ï¸ è¦ç´„ã‚’æœ€å¾Œã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ãŠèª­ã¿ãã ã•ã„ â¬‡ï¸
                </div>

                <div class="terms-agreement disabled" id="termsAgreementBox">
                    <input type="checkbox" id="termsAgreement" name="termsAgreement" onchange="toggleSubmitButton()">
                    <label for="termsAgreement">ä¸Šè¨˜ã®è²·å‡ºäººç« è¦ç´„ã«åŒæ„ã—ã¾ã™ <span class="required">*å¿…é ˆ</span></label>
                </div>
            </div>

            <!-- â˜…è¿½åŠ : æœˆé¡æ‰‹æ•°æ–™ã®æ³¨æ„æ›¸ã -->
            <div class="fee-notice">
                <div class="fee-notice-icon">ğŸ’°</div>
                <div class="fee-notice-content">
                    <div class="fee-notice-title">è³‡æ ¼ç¶­æŒæ‰‹æ•°æ–™ã«ã¤ã„ã¦</div>
                    <div class="fee-notice-amount">æœˆé¡ 800å††ï¼ˆç¨è¾¼ï¼‰</div>
                    <div class="fee-notice-desc">è²·å‡ºäººç« ã®ç™ºè¡Œå¾Œã€æ¯æœˆè‡ªå‹•ã§æ±ºæ¸ˆã•ã‚Œã¾ã™</div>
                </div>
            </div>

            <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
            <div class="btn-container">
                <button type="button" id="resetBtn" class="btn btn-secondary">ãƒªã‚»ãƒƒãƒˆ</button>
                <button type="submit" id="submitBtn" class="btn btn-primary" disabled>ç”³è«‹ã‚’é€ä¿¡</button>
            </div>
        </form>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div>å‡¦ç†ä¸­...</div>
        </div>

        <div class="message" id="message"></div>
    </div>

    <!-- ãƒˆãƒªãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="cropModal" class="crop-modal">
        <div class="crop-modal-content">
            <h2 style="text-align: center; margin-bottom: 10px;">ç”»åƒã‚’ãƒˆãƒªãƒŸãƒ³ã‚°</h2>
            <div class="crop-info">
                ğŸ“ ç¸¦35mm Ã— æ¨ª25mmï¼ˆç¸¦æ¨ªæ¯” 5:7ï¼‰ã«ãƒˆãƒªãƒŸãƒ³ã‚°ã•ã‚Œã¾ã™<br>
                ç”»åƒã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä½ç½®ã‚’èª¿æ•´ã—ã¦ãã ã•ã„
            </div>
            <div class="crop-container">
                <img id="cropImage" src="">
            </div>
            <div class="crop-buttons">
                <button type="button" class="btn btn-secondary" onclick="cancelCrop()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button type="button" class="btn btn-primary" onclick="confirmCrop()">ãƒˆãƒªãƒŸãƒ³ã‚°ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <script>
        // PDF.jsã®ãƒ¯ãƒ¼ã‚«ãƒ¼è¨­å®š
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let cropper = null;
        let photoData = null;
        let documentData = null;
        let selectedPhotoFile = null;
        let selectedDocumentFile = null;

        // ä»Šæ—¥ã®æ—¥ä»˜ã‚’è¨­å®š
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const dateString = today.getFullYear() + '-' + 
                             String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                             String(today.getDate()).padStart(2, '0');
            document.getElementById('date').value = dateString;
        });

        // é€ä¿¡ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆ
        function toggleSubmitButton() {
            const checkbox = document.getElementById('termsAgreement');
            const submitBtn = document.getElementById('submitBtn');
            const termsBox = document.getElementById('termsAgreementBox');
            
            if (checkbox.checked) {
                submitBtn.disabled = false;
                termsBox.classList.add('checked');
            } else {
                submitBtn.disabled = true;
                termsBox.classList.remove('checked');
            }
        }

        // é¡”å†™çœŸé¸æŠ
        function handlePhotoSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆ10MBä¸Šé™ï¼‰
            if (file.size > 10 * 1024 * 1024) {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯10MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ã€‚');
                event.target.value = '';
                return;
            }

            selectedPhotoFile = file;

            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('cropImage').src = e.target.result;
                showCropModal();
            };
            reader.readAsDataURL(file);
        }

        // å…¬çš„æ›¸é¡é¸æŠ
        function handleDocumentSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆ20MBä¸Šé™ï¼‰
            if (file.size > 20 * 1024 * 1024) {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯20MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ã€‚');
                event.target.value = '';
                return;
            }

            selectedDocumentFile = file;

            if (file.type === 'application/pdf') {
                // PDFå‡¦ç†
                processPdf(file);
            } else {
                // ç”»åƒå‡¦ç†
                processImage(file);
            }
        }

        function processPdf(file) {
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const typedArray = new Uint8Array(e.target.result);
                    const pdf = await pdfjsLib.getDocument(typedArray).promise;
                    const page = await pdf.getPage(1);
                    
                    const scale = 2;
                    const viewport = page.getViewport({ scale: scale });
                    
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    
                    await page.render({
                        canvasContext: context,
                        viewport: viewport
                    }).promise;
                    
                    compressAndStoreDocument(canvas, file.name);
                } catch (error) {
                    console.error('PDFå‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
                    alert('PDFã®å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function processImage(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    let width = img.width;
                    let height = img.height;
                    const maxSize = 1600;
                    
                    if (width > maxSize || height > maxSize) {
                        if (width > height) {
                            height = (height / width) * maxSize;
                            width = maxSize;
                        } else {
                            width = (width / height) * maxSize;
                            height = maxSize;
                        }
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    compressAndStoreDocument(canvas, file.name);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function compressAndStoreDocument(canvas, fileName) {
            const ctx = canvas.getContext('2d');
            let width = canvas.width;
            let height = canvas.height;
            const maxSize = 1600;
            
            if (width > maxSize || height > maxSize) {
                if (width > height) {
                    height = (height / width) * maxSize;
                    width = maxSize;
                } else {
                    width = (width / height) * maxSize;
                    height = maxSize;
                }
            }
            
            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(canvas, 0, 0, width, height);
            
            let quality = 0.8;
            let dataUrl = canvas.toDataURL('image/jpeg', quality);
            let size = dataUrl.length * 0.75;
            
            const targetSize = 500 * 1024;
            while (size > targetSize && quality > 0.5) {
                quality -= 0.1;
                dataUrl = canvas.toDataURL('image/jpeg', quality);
                size = dataUrl.length * 0.75;
            }
            
            documentData = dataUrl;
            
            const preview = document.getElementById('documentPreview');
            const sizeKB = (size / 1024).toFixed(1);
            const compressionInfo = quality < 0.8 ? `ï¼ˆå“è³ª${Math.round(quality*100)}%ã«åœ§ç¸®ï¼‰` : '';
            const isPdf = fileName.toLowerCase().endsWith('.pdf');
            const fileType = isPdf ? 'PDFâ†’JPEGå¤‰æ›' : 'JPEGåœ§ç¸®';
            
            preview.innerHTML = `
                <div class="file-info">
                    <strong>å…ƒãƒ•ã‚¡ã‚¤ãƒ«:</strong> ${fileName}<br>
                    <strong>å‡¦ç†:</strong> ${fileType}<br>
                    <strong>ã‚µã‚¤ã‚º:</strong> ${Math.floor(width)} Ã— ${Math.floor(height)} px<br>
                    <strong>å®¹é‡:</strong> ${sizeKB} KB ${compressionInfo}
                </div>
                <img src="${dataUrl}" style="margin-top: 10px; max-width: 300px; border: 1px solid #ddd;">
            `;
            preview.style.display = 'block';
        }

        function showCropModal() {
            const modal = document.getElementById('cropModal');
            modal.style.display = 'block';
            
            const image = document.getElementById('cropImage');
            
            if (cropper) {
                cropper.destroy();
            }
            
            cropper = new Cropper(image, {
                aspectRatio: 5 / 7,
                viewMode: 1,
                dragMode: 'move',
                autoCropArea: 1,
                restore: false,
                guides: true,
                center: true,
                highlight: false,
                cropBoxMovable: false,
                cropBoxResizable: false,
                toggleDragModeOnDblclick: false,
            });
        }

        function cancelCrop() {
            document.getElementById('cropModal').style.display = 'none';
            document.getElementById('photoUpload').value = '';
            document.getElementById('photoCamera').value = '';
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
        }

        function confirmCrop() {
            if (!cropper) return;
            
            const canvas = cropper.getCroppedCanvas({
                width: 250,
                height: 350,
                imageSmoothingQuality: 'high'
            });
            
            const croppedDataUrl = canvas.toDataURL('image/jpeg', 0.85);
            photoData = croppedDataUrl;
            
            const preview = document.getElementById('photoPreview');
            preview.innerHTML = `
                <div class="file-info">
                    <strong>ãƒ•ã‚¡ã‚¤ãƒ«å:</strong> ${selectedPhotoFile.name}<br>
                    <strong>ãƒˆãƒªãƒŸãƒ³ã‚°ã‚µã‚¤ã‚º:</strong> 250 Ã— 350 px (25mm Ã— 35mmç›¸å½“)
                </div>
                <img src="${croppedDataUrl}" style="margin-top: 10px; max-width: 200px;">
            `;
            preview.style.display = 'block';
            
            document.getElementById('cropModal').style.display = 'none';
            if (cropper) {
                cropper.destroy();
                cropper = null;
            }
        }

        function resetPhotoPreview() {
            document.getElementById('photoPreview').style.display = 'none';
            document.getElementById('photoPreview').innerHTML = '';
            document.getElementById('photoUpload').value = '';
            document.getElementById('photoCamera').value = '';
            photoData = null;
            selectedPhotoFile = null;
        }

        function resetDocumentPreview() {
            document.getElementById('documentPreview').style.display = 'none';
            document.getElementById('documentPreview').innerHTML = '';
            document.getElementById('documentUpload').value = '';
            document.getElementById('documentCamera').value = '';
            documentData = null;
            selectedDocumentFile = null;
        }




/*ã€€ãµã‚ŠãŒãªå…¥åŠ› */

// ========== ãµã‚ŠãŒãªè‡ªå‹•å…¥åŠ›æ©Ÿèƒ½ï¼ˆæ”¹è‰¯ç‰ˆï¼‰ ========== //

/**
 * ã‚«ã‚¿ã‚«ãƒŠã‚’ã²ã‚‰ãŒãªã«å¤‰æ›
 */
function convertToHiragana(str) {
    if (!str) return '';
    return str.replace(/[\u30A1-\u30F6]/g, function(match) {
        const chr = match.charCodeAt(0) - 0x60;
        return String.fromCharCode(chr);
    });
}

/**
 * ã²ã‚‰ãŒãªãƒ»ã‚«ã‚¿ã‚«ãƒŠã®ã¿ã‹ãƒã‚§ãƒƒã‚¯
 */
function isKana(str) {
    return /^[\u3040-\u309F\u30A0-\u30FF\s]+$/.test(str);
}

// ========== åº—åã®ãµã‚ŠãŒãªè‡ªå‹•å…¥åŠ› ========== //
let shopNameKanaBuffer = '';
let shopNameIsComposing = false;

document.getElementById('shopName').addEventListener('compositionstart', function() {
    shopNameIsComposing = true;
    shopNameKanaBuffer = '';
});

document.getElementById('shopName').addEventListener('compositionupdate', function(e) {
    if (!shopNameIsComposing) return;
    
    // e.dataã«ã¯å¤‰æ›ä¸­ã®æ–‡å­—åˆ—ãŒå…¥ã‚‹
    const inputText = e.data || '';
    
    // ã‹ãªæ–‡å­—ã®ã¿ã®å ´åˆã€ãƒãƒƒãƒ•ã‚¡ã«ä¿å­˜
    if (inputText && isKana(inputText)) {
        shopNameKanaBuffer = inputText;
    }
});

document.getElementById('shopName').addEventListener('compositionend', function(e) {
    shopNameIsComposing = false;
    
    // ãƒãƒƒãƒ•ã‚¡ã«ä¿å­˜ã•ã‚ŒãŸèª­ã¿ä»®åã‚’ãµã‚ŠãŒãªã«è¿½åŠ 
    if (shopNameKanaBuffer) {
        const kana = convertToHiragana(shopNameKanaBuffer);
        const currentFurigana = document.getElementById('shopNameFurigana').value;
        document.getElementById('shopNameFurigana').value = currentFurigana + kana;
    }
    
    shopNameKanaBuffer = '';
});

// åº—åãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚ŒãŸå ´åˆã€ãµã‚ŠãŒãªã‚‚ã‚¯ãƒªã‚¢
document.getElementById('shopName').addEventListener('input', function() {
    if (!shopNameIsComposing && this.value.trim() === '') {
        document.getElementById('shopNameFurigana').value = '';
    }
});

// ========== ä»£è¡¨è€…åã®ãµã‚ŠãŒãªè‡ªå‹•å…¥åŠ› ========== //
let representativeNameKanaBuffer = '';
let representativeNameIsComposing = false;

document.getElementById('representativeName').addEventListener('compositionstart', function() {
    representativeNameIsComposing = true;
    representativeNameKanaBuffer = '';
});

document.getElementById('representativeName').addEventListener('compositionupdate', function(e) {
    if (!representativeNameIsComposing) return;
    
    const inputText = e.data || '';
    
    if (inputText && isKana(inputText)) {
        representativeNameKanaBuffer = inputText;
    }
});

document.getElementById('representativeName').addEventListener('compositionend', function(e) {
    representativeNameIsComposing = false;
    
    if (representativeNameKanaBuffer) {
        const kana = convertToHiragana(representativeNameKanaBuffer);
        const currentFurigana = document.getElementById('representativeNameFurigana').value;
        document.getElementById('representativeNameFurigana').value = currentFurigana + kana;
    }
    
    representativeNameKanaBuffer = '';
});

document.getElementById('representativeName').addEventListener('input', function() {
    if (!representativeNameIsComposing && this.value.trim() === '') {
        document.getElementById('representativeNameFurigana').value = '';
    }
});

// ========== è²·å‡ºäººç« ç€ç”¨è€…æ°åã®ãµã‚ŠãŒãªè‡ªå‹•å…¥åŠ› ========== //
let wearerNameKanaBuffer = '';
let wearerNameIsComposing = false;

document.getElementById('wearerName').addEventListener('compositionstart', function() {
    wearerNameIsComposing = true;
    wearerNameKanaBuffer = '';
});

document.getElementById('wearerName').addEventListener('compositionupdate', function(e) {
    if (!wearerNameIsComposing) return;
    
    const inputText = e.data || '';
    
    if (inputText && isKana(inputText)) {
        wearerNameKanaBuffer = inputText;
    }
});

document.getElementById('wearerName').addEventListener('compositionend', function(e) {
    wearerNameIsComposing = false;
    
    if (wearerNameKanaBuffer) {
        const kana = convertToHiragana(wearerNameKanaBuffer);
        const currentFurigana = document.getElementById('wearerNameFurigana').value;
        document.getElementById('wearerNameFurigana').value = currentFurigana + kana;
    }
    
    wearerNameKanaBuffer = '';
});

document.getElementById('wearerName').addEventListener('input', function() {
    if (!wearerNameIsComposing && this.value.trim() === '') {
        document.getElementById('wearerNameFurigana').value = '';
    }
});

/*ã€€ãµã‚ŠãŒãªå…¥åŠ› */


// ========== ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹åŠè§’å¤‰æ› ========== //
document.getElementById('email').addEventListener('input', function(e) {
    // å…¨è§’è‹±æ•°å­—ãƒ»è¨˜å·ã‚’åŠè§’ã«å¤‰æ›
    let value = this.value;
    
    // å…¨è§’è‹±æ•°å­—ã‚’åŠè§’ã«å¤‰æ›
    value = value.replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, function(s) {
        return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
    });
    
    // å…¨è§’è¨˜å·ã‚’åŠè§’ã«å¤‰æ›
    value = value.replace(/ï¼ /g, '@');
    value = value.replace(/ï¼/g, '.');
    value = value.replace(/ï¼¿/g, '_');
    value = value.replace(/ï¼/g, '-');
    value = value.replace(/ã€€/g, ''); // å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰Šé™¤
    value = value.replace(/ /g, '');  // åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚‚å‰Šé™¤
    
    // å€¤ã‚’æ›´æ–°
    if (this.value !== value) {
        this.value = value;
    }
});

// ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¢ã‚¦ãƒˆæ™‚ã«ã‚‚å¤‰æ›
document.getElementById('email').addEventListener('blur', function(e) {
    let value = this.value;
    value = value.replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, function(s) {
        return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
    });
    value = value.replace(/ï¼ /g, '@');
    value = value.replace(/ï¼/g, '.');
    value = value.replace(/ï¼¿/g, '_');
    value = value.replace(/ï¼/g, '-');
    value = value.replace(/ã€€/g, '');
    value = value.replace(/ /g, '');
    
    if (this.value !== value) {
        this.value = value;
    }
});


// ========== éƒµä¾¿ç•ªå·å…¥åŠ› ========== //
let isComposing = false;

document.getElementById('postalCode').addEventListener('compositionstart', function() {
    isComposing = true;
});

document.getElementById('postalCode').addEventListener('compositionend', function() {
    isComposing = false;
});

let addressTimeout;
document.getElementById('postalCode').addEventListener('input', function(e) {
    if (isComposing) return; // IMEå…¥åŠ›ä¸­ã¯å‡¦ç†ã—ãªã„
    
    // æ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ã®ã¿è¨±å¯
    let value = this.value.replace(/[^0-9-]/g, '');
    
    // ãƒã‚¤ãƒ•ãƒ³ã‚’å…¨ã¦å‰Šé™¤ã—ã¦æ•°å­—ã ã‘å–ã‚Šå‡ºã™
    const numbersOnly = value.replace(/-/g, '');
    
    // 7æ¡ã‚’è¶…ãˆã‚‹å…¥åŠ›ã¯åˆ‡ã‚Šè©°ã‚
    const truncated = numbersOnly.substring(0, 7);
    
    // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã‚’ä¿å­˜
    const cursorPosition = this.selectionStart;
    const oldLength = this.value.length;
    
    // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: 3æ¡å…¥åŠ›å¾Œã¯è‡ªå‹•çš„ã«ãƒã‚¤ãƒ•ãƒ³è¿½åŠ 
    if (truncated.length > 3) {
        value = truncated.substring(0, 3) + '-' + truncated.substring(3);
    } else {
        value = truncated;
    }
    
    // å€¤ã‚’æ›´æ–°
    this.value = value;
    
    // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã‚’èª¿æ•´
    const newLength = this.value.length;
    const lengthDiff = newLength - oldLength;
    
    if (lengthDiff > 0 && value.includes('-') && cursorPosition === 3) {
        // ãƒã‚¤ãƒ•ãƒ³ãŒæŒ¿å…¥ã•ã‚ŒãŸç›´å¾Œã®å ´åˆã€ã‚«ãƒ¼ã‚½ãƒ«ã‚’ãƒã‚¤ãƒ•ãƒ³ã®å¾Œã‚ã«
        this.setSelectionRange(cursorPosition + 1, cursorPosition + 1);
    } else if (lengthDiff !== 0) {
        // ãã®ä»–ã®å ´åˆã€é©åˆ‡ãªä½ç½®ã«èª¿æ•´
        const newCursorPosition = Math.min(cursorPosition + lengthDiff, value.length);
        this.setSelectionRange(newCursorPosition, newCursorPosition);
    }
    
    // ä½æ‰€å–å¾—ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
    if (addressTimeout) {
        clearTimeout(addressTimeout);
    }
    
    // 7æ¡ã®å½¢å¼ï¼ˆxxx-xxxxï¼‰ãŒå®Œæˆã—ãŸã‚‰ä½æ‰€ã‚’å–å¾—
    if (/^\d{3}-\d{4}$/.test(this.value)) {
        addressTimeout = setTimeout(() => {
            getAddressFromPostalCode(this.value);
        }, 100);  // â˜…æ”¹å–„: 200ms â†’ 100msã«çŸ­ç¸®
    }
});

// ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¢ã‚¦ãƒˆæ™‚ã®å‡¦ç†
document.getElementById('postalCode').addEventListener('blur', function() {
    const numbersOnly = this.value.replace(/[^0-9]/g, '');
    
    if (numbersOnly.length === 7) {
        this.value = numbersOnly.substring(0, 3) + '-' + numbersOnly.substring(3);
        
        // ä½æ‰€å–å¾—
        if (addressTimeout) {
            clearTimeout(addressTimeout);
        }
        getAddressFromPostalCode(this.value);
    } else if (numbersOnly.length === 0) {
        this.value = '';
    }
});


        // ========== å¤–éƒ¨ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ç”¨ APIè¨­å®š ==========
        // â˜… ä»¥ä¸‹ã®URLã‚’å®Ÿéš›ã®GASãƒ‡ãƒ—ãƒ­ã‚¤URLã«å¤‰æ›´ã—ã¦ãã ã•ã„
        const API_URL = 'https://script.google.com/macros/s/AKfycbwbbyZoRzhWu8Ft5xVvyI1LJc7_RLZaeLwVGapXnlYIIJBUSlgJXQTzofwuLl5nux43kg/exec';

        // APIå‘¼ã³å‡ºã—å…±é€šé–¢æ•°
        async function callApi(action, data = {}) {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain',
                },
                body: JSON.stringify({ action, ...data })
            });
            return await response.json();
        }

        // â˜…æ”¹å–„: éƒµä¾¿ç•ªå·â†’ä½æ‰€å¤‰æ›ï¼ˆç›´æ¥APIå‘¼ã³å‡ºã—ã§é«˜é€ŸåŒ–ï¼‰
        function getAddressFromPostalCode(postalCode) {
            const zipCode = postalCode.replace('-', '');
            const addressField = document.getElementById('address');
            
            // æ¤œç´¢ä¸­è¡¨ç¤º
            addressField.value = 'æ¤œç´¢ä¸­...';
            addressField.style.backgroundColor = '#fff3cd';
            
            // ç›´æ¥ zipcloud API ã‚’å‘¼ã³å‡ºã—ï¼ˆGASçµŒç”±ã‚ˆã‚Šé«˜é€Ÿï¼‰
            fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${zipCode}`)
                .then(response => response.json())
                .then(data => {
                    if (data.results && data.results[0]) {
                        const result = data.results[0];
                        const address = result.address1 + result.address2 + result.address3;
                        addressField.value = address;
                        addressField.style.backgroundColor = '#d4edda'; // æˆåŠŸæ™‚ã¯ç·‘
                        
                        // 2ç§’å¾Œã«èƒŒæ™¯è‰²ã‚’ãƒªã‚»ãƒƒãƒˆ
                        setTimeout(() => {
                            addressField.style.backgroundColor = '#f8f9fa';
                        }, 2000);
                    } else {
                        addressField.value = '';
                        addressField.placeholder = 'ä½æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ';
                        addressField.style.backgroundColor = '#fff';
                    }
                })
                .catch(error => {
                    console.error('ä½æ‰€å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                    addressField.value = '';
                    addressField.style.backgroundColor = '#fff';
                });
        }

        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º
        function showLoadingOverlay(show) {
            const overlay = document.getElementById('loadingOverlay');
            if (show) {
                overlay.classList.add('show');
            } else {
                overlay.classList.remove('show');
            }
        }

        // æˆåŠŸã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º
        function showSuccessOverlay(memberId) {
            const overlay = document.getElementById('successOverlay');
            document.getElementById('successMemberId').textContent = 'ä¼šå“¡ç•ªå·: ' + memberId;
            overlay.classList.add('show');
        }

        // æˆåŠŸã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’é–‰ã˜ã‚‹
        function closeSuccessOverlay() {
            const overlay = document.getElementById('successOverlay');
            overlay.classList.remove('show');
        }

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
        document.getElementById('applicationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!validateForm()) {
                return;
            }

            showLoadingOverlay(true);
            document.getElementById('submitBtn').disabled = true;

            const formData = {
                date: document.getElementById('date').value,
                storeName: document.getElementById('shopName').value,
                storeNameFurigana: document.getElementById('shopNameFurigana').value,
                representativeName: document.getElementById('representativeName').value,
                representativeNameFurigana: document.getElementById('representativeNameFurigana').value,
                badgeWearerName: document.getElementById('wearerName').value,
                badgeWearerNameFurigana: document.getElementById('wearerNameFurigana').value,
                postalCode: document.getElementById('postalCode').value,
                address: document.getElementById('address').value,
                phone: document.getElementById('phone').value,
                fax: document.getElementById('fax').value,
                email: document.getElementById('email').value,
                contactPhone: document.getElementById('contactPhone').value,
                remarks: document.getElementById('remarks').value,
                businessType: document.getElementById('businessType').value,
                mainCustomers: document.getElementById('mainCustomers').value
            };

            const applicantName = formData.representativeName || formData.storeName;

            // async/awaitç‰ˆã®ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
            submitFormAsync(formData, applicantName);
        });

        // éåŒæœŸãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
        async function submitFormAsync(formData, applicantName) {
            try {
                // ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
                const folderResult = await callApi('createFolder', { applicantName });
                
                if (!folderResult.success) {
                    showLoadingOverlay(false);
                    document.getElementById('submitBtn').disabled = false;
                    showMessage('ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆã‚¨ãƒ©ãƒ¼: ' + folderResult.error, 'error');
                    return;
                }

                const folderId = folderResult.folderId;

                // ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰
                const uploadPromises = [];

                // é¡”å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                if (photoData) {
                    uploadPromises.push(
                        callApi('uploadFile', {
                            dataUrl: photoData,
                            fileName: selectedPhotoFile.name,
                            folderId: folderId,
                            fileType: 'photo'
                        }).then(result => {
                            formData.photoFile = result;
                        }).catch(error => {
                            console.error('é¡”å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
                            formData.photoFile = { success: false, error: error.toString() };
                        })
                    );
                }

                // å…¬çš„æ›¸é¡ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                if (documentData) {
                    uploadPromises.push(
                        callApi('uploadFile', {
                            dataUrl: documentData,
                            fileName: selectedDocumentFile.name,
                            folderId: folderId,
                            fileType: 'document'
                        }).then(result => {
                            formData.documentFile = result;
                        }).catch(error => {
                            console.error('å…¬çš„æ›¸é¡ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
                            formData.documentFile = { success: false, error: error.toString() };
                        })
                    );
                }

                // å…¨ã¦ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’å¾…æ©Ÿ
                await Promise.all(uploadPromises);

                // ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ä¿å­˜
                const result = await callApi('saveForm', { formData });
                
                showLoadingOverlay(false);
                document.getElementById('submitBtn').disabled = false;
                
                if (result.success) {
                    // æˆåŠŸã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’è¡¨ç¤º
                    showSuccessOverlay(result.memberId);
                    
                    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
                    document.getElementById('applicationForm').reset();
                    resetPhotoPreview();
                    resetDocumentPreview();
                    
                    // è¦ç´„ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚‚ãƒªã‚»ãƒƒãƒˆ
                    document.getElementById('termsAgreement').checked = false;
                    document.getElementById('termsAgreementBox').classList.remove('checked');
                    document.getElementById('submitBtn').disabled = true;
                    
                    // è¦ç´„ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«çŠ¶æ…‹ã‚‚ãƒªã‚»ãƒƒãƒˆ
                    hasScrolledToBottom = false;
                    document.getElementById('termsAgreementBox').classList.add('disabled');
                    document.getElementById('scrollHint').classList.remove('hidden');
                    
                    const today = new Date();
                    const dateString = today.getFullYear() + '-' + 
                                     String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                                     String(today.getDate()).padStart(2, '0');
                    document.getElementById('date').value = dateString;
                } else {
                    showMessage('ã‚¨ãƒ©ãƒ¼: ' + (result.error || result.message), 'error');
                }

            } catch (error) {
                showLoadingOverlay(false);
                document.getElementById('submitBtn').disabled = false;
                showMessage('é€ä¿¡ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.toString(), 'error');
            }
        }

        // æ—§submitFormDataé–¢æ•°ã¯ä¸è¦ã«ãªã‚Šã¾ã—ãŸãŒã€äº’æ›æ€§ã®ãŸã‚æ®‹ã™
        function submitFormData(formData) {
            callApi('saveForm', { formData })
                .then(result => {
                    showLoadingOverlay(false);
                    document.getElementById('submitBtn').disabled = false;
                    
                    if (result.success) {
                        // æˆåŠŸã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’è¡¨ç¤º
                        showSuccessOverlay(result.memberId);
                        
                        // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
                        document.getElementById('applicationForm').reset();
                        resetPhotoPreview();
                        resetDocumentPreview();
                        
                        // è¦ç´„ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚‚ãƒªã‚»ãƒƒãƒˆ
                        document.getElementById('termsAgreement').checked = false;
                        document.getElementById('termsAgreementBox').classList.remove('checked');
                        document.getElementById('submitBtn').disabled = true;
                        
                        const today = new Date();
                        const dateString = today.getFullYear() + '-' + 
                                         String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                                         String(today.getDate()).padStart(2, '0');
                        document.getElementById('date').value = dateString;
                    } else {
                        showMessage('ã‚¨ãƒ©ãƒ¼: ' + (result.error || result.message), 'error');
                    }
                })
                .catch(error => {
                    showLoadingOverlay(false);
                    document.getElementById('submitBtn').disabled = false;
                    showMessage('é€ä¿¡ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.toString(), 'error');
                });
        }

        // ãƒªã‚»ãƒƒãƒˆ
        document.getElementById('resetBtn').addEventListener('click', function() {
            if (confirm('å…¥åŠ›å†…å®¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                document.getElementById('applicationForm').reset();
                resetPhotoPreview();
                resetDocumentPreview();
                
                // è¦ç´„ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚‚ãƒªã‚»ãƒƒãƒˆ
                document.getElementById('termsAgreement').checked = false;
                document.getElementById('termsAgreementBox').classList.remove('checked');
                document.getElementById('submitBtn').disabled = true;
                
                // è¦ç´„ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«çŠ¶æ…‹ã‚‚ãƒªã‚»ãƒƒãƒˆ
                hasScrolledToBottom = false;
                document.getElementById('termsAgreementBox').classList.add('disabled');
                document.getElementById('scrollHint').classList.remove('hidden');
                
                const today = new Date();
                const dateString = today.getFullYear() + '-' + 
                                 String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                                 String(today.getDate()).padStart(2, '0');
                document.getElementById('date').value = dateString;
                
                hideMessage();
            }
        });

        function validateForm() {
            const requiredFields = [
                'date', 'shopName', 'shopNameFurigana', 'representativeName', 
                'representativeNameFurigana', 'wearerName', 'wearerNameFurigana',
                'postalCode', 'address', 'phone', 'businessType', 'email'
            ];

            for (let fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    showMessage('å¿…é ˆé …ç›®ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“: ' + field.previousElementSibling.textContent.replace(' *å¿…é ˆ', ''), 'error');
                    field.focus();
                    return false;
                }
            }

            const postalCode = document.getElementById('postalCode').value;
            if (!/^\d{3}-\d{4}$/.test(postalCode)) {
                showMessage('éƒµä¾¿ç•ªå·ã¯000-0000ã®å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'error');
                document.getElementById('postalCode').focus();
                return false;
            }

            if (!photoData) {
                showMessage('ç”³è«‹è€…æœ¬äººã®é¡”å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚', 'error');
                return false;
            }

            if (!documentData) {
                showMessage('èŠ±ãæ¥­ã®è¨˜è¼‰ã®ã‚ã‚‹å…¬çš„æ›¸é¡ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚', 'error');
                return false;
            }

            // è¦ç´„åŒæ„ãƒã‚§ãƒƒã‚¯
            const termsAgreed = document.getElementById('termsAgreement').checked;
            if (!termsAgreed) {
                showMessage('è²·å‡ºäººç« è¦ç´„ã«åŒæ„ã—ã¦ãã ã•ã„ã€‚', 'error');
                document.getElementById('termsAgreement').focus();
                return false;
            }

            // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ãƒã‚§ãƒƒã‚¯
            const email = document.getElementById('email').value;
            if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showMessage('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚', 'error');
                document.getElementById('email').focus();
                return false;
            }

            return true;
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showMessage(message, type) {
            const messageElement = document.getElementById('message');
            messageElement.textContent = message;
            messageElement.className = 'message ' + type;
            messageElement.style.display = 'block';
            
            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºä½ç½®ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            messageElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            if (type === 'success') {
                setTimeout(() => {
                    hideMessage();
                }, 5000);
            }
        }

        function hideMessage() {
            document.getElementById('message').style.display = 'none';
        }

        // ========== â˜…è¿½åŠ : è¦ç´„ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç›£è¦– ========== //
        const termsContent = document.getElementById('termsContent');
        const termsAgreementBox = document.getElementById('termsAgreementBox');
        const termsCheckbox = document.getElementById('termsAgreement');
        const scrollHint = document.getElementById('scrollHint');

        let hasScrolledToBottom = false;

        termsContent.addEventListener('scroll', function() {
            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ãŒæœ€å¾Œã«è¿‘ã„ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆä½™è£•ã‚’æŒãŸã›ã¦30pxï¼‰
            const isAtBottom = termsContent.scrollHeight - termsContent.scrollTop - termsContent.clientHeight < 30;
            
            if (isAtBottom && !hasScrolledToBottom) {
                hasScrolledToBottom = true;
                
                // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’æœ‰åŠ¹åŒ–
                termsAgreementBox.classList.remove('disabled');
                
                // ãƒ’ãƒ³ãƒˆã‚’éè¡¨ç¤º
                scrollHint.classList.add('hidden');
                
                console.log('è¦ç´„ã‚’æœ€å¾Œã¾ã§èª­ã¿ã¾ã—ãŸ');
            }
        });

        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒdisabledçŠ¶æ…‹ã§ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        termsAgreementBox.addEventListener('click', function(e) {
            if (termsAgreementBox.classList.contains('disabled')) {
                e.preventDefault();
                e.stopPropagation();
                alert('è¦ç´„ã‚’æœ€å¾Œã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ãŠèª­ã¿ãã ã•ã„ã€‚');
                termsContent.focus();
                // è¦ç´„æ¬„ã‚’å°‘ã—ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ä¿ƒã™
                termsContent.scrollTop += 50;
            }
        });
    </script>
</body>
</html>
