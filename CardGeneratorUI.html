<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è²·å‡ºäººç« ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
  <!-- â˜… ãƒ•ã‚¡ãƒ“ã‚³ãƒ³è¿½åŠ  -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ«</text></svg>">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ«</text></svg>">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', sans-serif;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .container {
      max-width: 1050px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    
    h1 {
      color: #667eea;
      text-align: center;
      margin-bottom: 10px;
      font-size: 26px;
    }
    
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 15px;
      font-size: 14px;
    }
    
    /* ========== ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ ========== */
    .nav-links {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    
    .nav-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 10px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-decoration: none;
      border-radius: 25px;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }
    
    .nav-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .nav-link.email {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      box-shadow: 0 2px 8px rgba(245, 87, 108, 0.3);
    }
    
    .nav-link.email:hover {
      box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
    }
    
    .nav-link.form {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      box-shadow: 0 2px 8px rgba(17, 153, 142, 0.3);
    }
    
    .nav-link.form:hover {
      box-shadow: 0 4px 15px rgba(17, 153, 142, 0.4);
    }
    
    /* ========== æ¤œç´¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ ========== */
    .search-section {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      border: 2px solid #667eea;
    }
    
    .search-section h2 {
      font-size: 16px;
      color: #333;
      margin-bottom: 15px;
    }
    
    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .search-input {
      flex: 1;
      padding: 12px 15px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    
    .search-input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .search-input::placeholder {
      color: #999;
    }
    
    .btn-search {
      padding: 12px 25px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
    }
    
    .btn-search:hover {
      background: #5568d3;
    }
    
    .btn-recent {
      padding: 12px 20px;
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
    }
    
    .btn-recent:hover {
      background: #545b62;
    }
    
    /* ========== æ¤œç´¢çµæœ ========== */
    .search-results {
      margin-top: 15px;
    }
    
    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid #ddd;
    }
    
    .results-count {
      font-size: 14px;
      color: #666;
    }
    
    /* ========== åˆ—ãƒ˜ãƒƒãƒ€ãƒ¼ ========== */
    .results-column-header {
      display: grid;
      grid-template-columns: 35px 85px 1fr 120px 55px 55px 60px;
      gap: 8px;
      padding: 10px 15px;
      background: #667eea;
      color: white;
      font-size: 12px;
      font-weight: bold;
      border-radius: 6px 6px 0 0;
    }
    
    .results-column-header span {
      text-align: center;
    }
    
    .results-column-header span:nth-child(2) {
      text-align: left;
    }
    
    .results-column-header span:nth-child(3),
    .results-column-header span:nth-child(4) {
      text-align: left;
    }
    
    .results-list {
      max-height: 350px;
      overflow-y: auto;
      border: 1px solid #e0e0e0;
      border-top: none;
      border-radius: 0 0 6px 6px;
    }
    
    .result-item {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .result-item:last-child {
      border-bottom: none;
    }
    
    .result-item:hover {
      background-color: #f5f5f5;
    }
    
    .result-item.selected {
      background-color: #e8f0fe;
      border-left: 4px solid #667eea;
    }
    
    .result-radio {
      margin-right: 12px;
      width: 18px;
      height: 18px;
      cursor: pointer;
      flex-shrink: 0;
    }
    
    .result-info {
      flex: 1;
      display: grid;
      grid-template-columns: 85px 1fr 120px 55px 55px 60px;
      gap: 8px;
      align-items: center;
    }
    
    .result-member-id {
      font-weight: bold;
      color: #667eea;
      font-size: 14px;
    }
    
    .result-store-name {
      font-size: 14px;
      color: #333;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .result-wearer-name {
      font-size: 14px;
      color: #555;
    }
    
    .result-status {
      font-size: 12px;
      padding: 3px 8px;
      border-radius: 4px;
      text-align: center;
    }
    
    .status-active {
      background: #d4edda;
      color: #155724;
    }
    
    .status-inactive {
      background: #f8d7da;
      color: #721c24;
    }
    
    .status-pending {
      background: #fff3cd;
      color: #856404;
    }
    
    /* ========== å°åˆ·å›æ•° ========== */
    .result-print-count {
      font-size: 13px;
      text-align: center;
      font-weight: bold;
    }
    
    .print-count-zero {
      color: #ccc;
    }
    
    .print-count-has {
      color: #28a745;
    }
    
    /* ========== é¸æŠä¸­ã®ä¼šå“¡ ========== */
    .selected-member {
      background: #e8f0fe;
      border: 2px solid #667eea;
      border-radius: 8px;
      padding: 15px 20px;
      margin: 20px 0;
      display: none;
    }
    
    .selected-member.show {
      display: block;
    }
    
    .selected-member h3 {
      font-size: 14px;
      color: #667eea;
      margin-bottom: 10px;
    }
    
    .selected-info {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      font-size: 15px;
    }
    
    .selected-info span {
      color: #333;
    }
    
    .selected-info strong {
      color: #667eea;
    }
    
    .selected-print-count {
      color: #28a745 !important;
      font-weight: bold;
    }
    
    /* ========== ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ ========== */
    .action-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 15px;
      margin-top: 20px;
    }
    
    .btn {
      padding: 15px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-detail {
      background: #17a2b8;
      color: white;
    }
    
    .btn-detail:hover:not(:disabled) {
      background: #138496;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(23, 162, 184, 0.3);
    }
    
    .btn-card {
      background: #667eea;
      color: white;
    }
    
    .btn-card:hover:not(:disabled) {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .btn-application {
      background: #28a745;
      color: white;
    }
    
    .btn-application:hover:not(:disabled) {
      background: #218838;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
    }
    
    .btn-both {
      background: #fd7e14;
      color: white;
    }
    
    .btn-both:hover:not(:disabled) {
      background: #e96b02;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(253, 126, 20, 0.3);
    }
    
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    
    /* ========== ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ========== */
    .message {
      padding: 15px;
      margin: 15px 0;
      border-radius: 6px;
      display: none;
    }
    
    .message.success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }
    
    .message.error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
    
    .message.info {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      color: #0c5460;
    }
    
    /* ========== ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° ========== */
    .loading {
      display: none;
      text-align: center;
      padding: 30px;
    }
    
    .spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* ========== çµæœãƒªãƒ³ã‚¯ ========== */
    .result-link {
      display: block;
      margin-top: 10px;
      padding: 12px;
      background: #e7f3ff;
      border-radius: 6px;
      text-align: center;
    }
    
    .result-link a {
      color: #0066cc;
      text-decoration: none;
      font-weight: bold;
      font-size: 15px;
    }
    
    .result-link a:hover {
      text-decoration: underline;
    }
    
    /* ========== ä¸€æ‹¬ç”Ÿæˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ ========== */
    .batch-section {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid #e0e0e0;
    }
    
    .batch-section h3 {
      font-size: 14px;
      color: #666;
      margin-bottom: 15px;
    }
    
    .batch-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .btn-batch {
      padding: 10px 20px;
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .btn-batch:hover {
      background: #545b62;
    }
    
    /* ========== å°åˆ·æ–¹æ³•ãƒ˜ãƒ«ãƒ— ========== */
    .help-box {
      background: #fff3cd;
      border: 1px solid #ffc107;
      padding: 15px;
      border-radius: 6px;
      margin-top: 20px;
      font-size: 13px;
      color: #856404;
    }
    
    .help-box strong {
      display: block;
      margin-bottom: 8px;
    }
    
    /* ========== ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– ========== */
    @media (max-width: 900px) {
      .action-buttons {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .container {
        padding: 20px;
      }
      
      .search-box {
        flex-direction: column;
      }
      
      .results-column-header {
        display: none;
      }
      
      .result-info {
        grid-template-columns: 1fr;
        gap: 5px;
      }
      
      .result-item {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .result-radio {
        margin-bottom: 8px;
      }
      
      /* ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒ©ãƒ™ãƒ«è¡¨ç¤º */
      .result-info span::before {
        font-weight: bold;
        color: #667eea;
        margin-right: 5px;
      }
      
      .result-member-id::before { content: "ä¼šå“¡ID: "; }
      .result-store-name::before { content: "åº—å: "; }
      .result-wearer-name::before { content: "æ°å: "; }
      .result-print-count.card-count::before { content: "ã‚«ãƒ¼ãƒ‰: "; }
      .result-print-count.app-count::before { content: "ç”³è«‹æ›¸: "; }
      
      .action-buttons {
        grid-template-columns: 1fr;
      }
      
      .nav-links {
        flex-direction: column;
        align-items: center;
      }
    }


    /* ========== ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ãƒ¢ãƒ¼ãƒ€ãƒ« ========== */
.auth-overlay {
    display: flex;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    justify-content: center;
    align-items: center;
    z-index: 10000;
}

.auth-overlay.hidden {
    display: none;
}

.auth-modal {
    background: white;
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    text-align: center;
    max-width: 400px;
    width: 90%;
    animation: authModalIn 0.3s ease;
}

@keyframes authModalIn {
    from { opacity: 0; transform: scale(0.9) translateY(-20px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    20%, 60% { transform: translateX(-10px); }
    40%, 80% { transform: translateX(10px); }
}

.auth-modal h2 {
    color: #4285f4;
    margin-bottom: 10px;
    font-size: 24px;
}

.auth-modal .auth-subtitle {
    color: #666;
    margin-bottom: 30px;
    font-size: 14px;
}

.auth-modal .auth-icon {
    font-size: 60px;
    margin-bottom: 20px;
}

.auth-modal input[type="password"] {
    width: 100%;
    padding: 15px;
    font-size: 18px;
    border: 2px solid #ddd;
    border-radius: 8px;
    margin-bottom: 20px;
    text-align: center;
    letter-spacing: 4px;
}

.auth-modal input[type="password"]:focus {
    outline: none;
    border-color: #4285f4;
    box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.2);
}

.auth-modal .auth-btn {
    width: 100%;
    padding: 15px;
    font-size: 16px;
    font-weight: bold;
    color: white;
    background: linear-gradient(135deg, #4285f4, #34a853);
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
}

.auth-modal .auth-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(66, 133, 244, 0.4);
}

.auth-modal .auth-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.auth-modal .auth-error {
    color: #dc3545;
    font-size: 14px;
    margin-top: 15px;
    padding: 10px;
    background: #ffebee;
    border-radius: 6px;
    display: none;
}

.auth-modal .auth-error.show {
    display: block;
}

.auth-modal .auth-hint {
    color: #999;
    font-size: 12px;
    margin-top: 20px;
}
    /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« */
    .print-checkbox {
      width: 18px;
      height: 18px;
      cursor: default;
      accent-color: #28a745;
    }
  </style>
</head>
<body>

<!-- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
<div id="authOverlay" class="auth-overlay">
    <div class="auth-modal">
        <div class="auth-icon">ğŸ”</div>
        <h2>ç®¡ç†è€…èªè¨¼</h2>
        <p class="auth-subtitle">ç®¡ç†ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¿…è¦ã§ã™</p>
        
        <form id="authForm" onsubmit="return handleAuthSubmit(event)">
            <input type="password" id="authPassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" autocomplete="current-password" required>
            <button type="submit" class="auth-btn" id="authSubmitBtn">ğŸ”“ ãƒ­ã‚°ã‚¤ãƒ³</button>
        </form>
        
        <div id="authError" class="auth-error"></div>
        
        <p class="auth-hint">â€» ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚ŒãŸå ´åˆã¯ç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„</p>
    </div>
</div>
  
  <div class="container">
    <h1>ğŸ« è²·å‡ºäººç« ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
    <div class="subtitle">ä¼šå“¡æ¤œç´¢ãƒ»ã‚«ãƒ¼ãƒ‰ç”Ÿæˆãƒ»ç”³è«‹æ›¸å°åˆ·</div>
    
    <!-- â˜…ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯è¿½åŠ  -->
    <div class="nav-links">
      <a href="EmailSender.html" class="nav-link email">ğŸ“§ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚·ã‚¹ãƒ†ãƒ </a>
      <a href="index.html" class="nav-link form" target="_blank">ğŸ“ ç”³è«‹ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã</a>
    </div>
    
    <!-- æ¤œç´¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="search-section">
      <h2>ğŸ” ä¼šå“¡æ¤œç´¢</h2>
      <div class="search-box">
        <input type="text" 
               class="search-input" 
               id="searchKeyword" 
               placeholder="ä¼šå“¡ç•ªå·ã€åº—åã€æ°åã§æ¤œç´¢ï¼ˆä¾‹ï¼šK10032ã€éŠ€åº§ã€å±±ç”°ï¼‰"
               onkeypress="handleSearchKeypress(event)">
        <button class="btn-search" onclick="searchMembers()">ğŸ” æ¤œç´¢</button>
        <button class="btn-recent" onclick="loadRecentMembers()">ğŸ“‹ æœ€æ–°20ä»¶</button>
      </div>
      
      <!-- æ¤œç´¢çµæœ -->
      <div class="search-results" id="searchResults" style="display: none;">
        <div class="results-header">
          <span class="results-count" id="resultsCount">0ä»¶</span>
        </div>
        <!-- åˆ—ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="results-column-header">
          <span></span>
          <span>ä¼šå“¡ID</span>
          <span>åº—å</span>
          <span>æ°å</span>
          <span>ã‚«ãƒ¼ãƒ‰æ¸ˆ</span>
          <span>ç”³è«‹æ›¸æ¸ˆ</span>
          <span>çŠ¶æ…‹</span>
        </div>
        <div class="results-list" id="resultsList">
          <!-- æ¤œç´¢çµæœãŒã“ã“ã«å…¥ã‚‹ -->
        </div>
      </div>
    </div>
    
    <!-- é¸æŠä¸­ã®ä¼šå“¡ -->
    <div class="selected-member" id="selectedMember">
      <h3>ğŸ“Œ é¸æŠä¸­ã®ä¼šå“¡</h3>
      <div class="selected-info">
        <span><strong>ä¼šå“¡ç•ªå·:</strong> <span id="selectedMemberId">-</span></span>
        <span><strong>åº—å:</strong> <span id="selectedStoreName">-</span></span>
        <span><strong>ç€ç”¨è€…:</strong> <span id="selectedWearerName">-</span></span>
        <span><strong>ã‚«ãƒ¼ãƒ‰:</strong> <span id="selectedCardCount" class="selected-print-count">0</span>å›</span>
        <span><strong>ç”³è«‹æ›¸:</strong> <span id="selectedAppCount" class="selected-print-count">0</span>å›</span>
        <span><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong> <span id="selectedStatus">-</span></span>
      </div>
    </div>
    
    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
    <div class="action-buttons">
      <button class="btn btn-detail" id="btnDetail" onclick="openMemberDetail()" disabled>
        ğŸ‘¤ ä¼šå“¡è©³ç´°
      </button>
      <button class="btn btn-card" id="btnCard" onclick="generateCard()" disabled>
        ğŸ« ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
      </button>
      <button class="btn btn-application" id="btnApplication" onclick="generateApplication()" disabled>
        ğŸ“‹ ç”³è«‹æ›¸ç”Ÿæˆ
      </button>
      <button class="btn btn-both" id="btnBoth" onclick="generateBoth()" disabled>
        ğŸ“¦ ä¸¡æ–¹ç”Ÿæˆ
      </button>
    </div>
    
    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <div style="margin-top: 10px;">å‡¦ç†ä¸­...</div>
    </div>
    
    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div class="message" id="message"></div>
    
    <!-- å°åˆ·æ–¹æ³•ãƒ˜ãƒ«ãƒ— -->
    <div class="help-box">
      <strong>ğŸ’¾ PDFå°åˆ·æ–¹æ³•ï¼š</strong>
      1. ç”Ÿæˆã•ã‚ŒãŸãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯<br>
      2. ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã€â†’ã€Œãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€â†’ã€ŒPDFã€ã‚’é¸æŠ<br>
      3. ã‚«ãƒ¼ãƒ‰: B5ç¸¦ã§å°åˆ·ï¼ˆä¸Šéƒ¨55mmã«ã‚«ãƒ¼ãƒ‰ï¼‰ / ç”³è«‹æ›¸: A4ç¸¦ã§å°åˆ·
    </div>
    
    <!-- ä¸€æ‹¬ç”Ÿæˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="batch-section">
      <h3>âš™ï¸ ä¸€æ‹¬å‡¦ç†ãƒ»ãƒ†ã‚¹ãƒˆ</h3>
      <div class="batch-buttons">
        <button class="btn-batch" onclick="generateTestCard()">ğŸ§ª ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰ç”Ÿæˆ</button>
        <button class="btn-batch" onclick="generateAllCards()">ğŸ“Š å…¨ã‚«ãƒ¼ãƒ‰ä¸€æ‹¬ç”Ÿæˆ</button>
        <button class="btn-batch" onclick="generateAllApplications()">ğŸ“Š å…¨ç”³è«‹æ›¸ä¸€æ‹¬ç”Ÿæˆ</button>
      </div>
    </div>
  </div>
  
  <script>

// ========== ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã‚·ã‚¹ãƒ†ãƒ  ========== //

const AUTH_STORAGE_KEY = 'ota_admin_auth';
const AUTH_EXPIRY_HOURS = 24;

function checkAuthentication() {
    const authData = localStorage.getItem(AUTH_STORAGE_KEY);
    
    if (!authData) {
        showAuthModal();
        return false;
    }
    
    try {
        const { token, expiresAt } = JSON.parse(authData);
        
        if (Date.now() > expiresAt) {
            localStorage.removeItem(AUTH_STORAGE_KEY);
            showAuthModal();
            return false;
        }
        
        hideAuthModal();
        return true;
        
    } catch (e) {
        localStorage.removeItem(AUTH_STORAGE_KEY);
        showAuthModal();
        return false;
    }
}

function showAuthModal() {
    document.getElementById('authOverlay').classList.remove('hidden');
    document.getElementById('authPassword').focus();
    document.body.style.overflow = 'hidden';
}

function hideAuthModal() {
    document.getElementById('authOverlay').classList.add('hidden');
    document.body.style.overflow = '';
}

async function handleAuthSubmit(event) {
    event.preventDefault();
    
    const password = document.getElementById('authPassword').value;
    const submitBtn = document.getElementById('authSubmitBtn');
    const errorDiv = document.getElementById('authError');
    
    if (!password) {
        showAuthError('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return false;
    }
    
    submitBtn.disabled = true;
    submitBtn.textContent = 'ğŸ”„ èªè¨¼ä¸­...';
    errorDiv.classList.remove('show');
    
    try {
        // IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—
        let clientIP = '';
        try {
            const ipResponse = await fetch('https://api.ipify.org?format=json');
            const ipData = await ipResponse.json();
            clientIP = ipData.ip;
        } catch (e) { }
        
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'text/plain' },
            body: JSON.stringify({
                action: 'verifyAdminPassword',
                password: password,
                clientIP: clientIP
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            const authData = {
                token: result.token,
                expiresAt: result.expiresAt
            };
            localStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(authData));
            
            hideAuthModal();
            
            if (typeof initializePage === 'function') {
                initializePage();
            }
            
        } else {
            showAuthError(result.error || 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
        }
        
    } catch (error) {
        console.error('èªè¨¼ã‚¨ãƒ©ãƒ¼:', error);
        showAuthError('èªè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'ğŸ”“ ãƒ­ã‚°ã‚¤ãƒ³';
    }
    
    return false;
}

function showAuthError(message) {
    const errorDiv = document.getElementById('authError');
    errorDiv.textContent = message;
    errorDiv.classList.add('show');
    
    const passwordInput = document.getElementById('authPassword');
    passwordInput.style.animation = 'none';
    passwordInput.offsetHeight;
    passwordInput.style.animation = 'shake 0.5s';
    passwordInput.select();
}

function logout() {
    localStorage.removeItem(AUTH_STORAGE_KEY);
    showAuthModal();
}

    // ========== IPã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾— ========== //
    let cachedClientIP = null;
    
    async function getClientIP() {
      if (cachedClientIP) return cachedClientIP;
      try {
        const response = await fetch('https://api.ipify.org?format=json', { timeout: 3000 });
        const data = await response.json();
        cachedClientIP = data.ip;
        return data.ip;
      } catch (e) {
        console.log('IPå–å¾—ã‚¹ã‚­ãƒƒãƒ—');
        return '';
      }
    }
    
    // èµ·å‹•æ™‚ã«IPã‚’å–å¾—ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
    getClientIP();
    
    // â˜… GAS API URLï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤URLã‚’è¨­å®šï¼‰
    const API_URL = 'https://script.google.com/macros/s/AKfycbwbbyZoRzhWu8Ft5xVvyI1LJc7_RLZaeLwVGapXnlYIIJBUSlgJXQTzofwuLl5nux43kg/exec';
    
    // â˜… MemberDetail.html ã®URLï¼ˆGitHub Pagesï¼‰
    const MEMBER_DETAIL_URL = 'https://otajigyokyo.github.io/appliyform/MemberDetail.html';
    
    // é¸æŠä¸­ã®ä¼šå“¡ãƒ‡ãƒ¼ã‚¿
    let selectedMemberData = null;
    
    // ========== APIå‘¼ã³å‡ºã—å…±é€šé–¢æ•° ========== //
    async function callApi(action, data = {}) {
      try {
        const clientIP = await getClientIP();
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'text/plain',
          },
          body: JSON.stringify({ action, clientIP, ...data })
        });
        return await response.json();
      } catch (error) {
        console.error('APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼:', error);
        throw error;
      }
    }
    
    // ========== æ¤œç´¢æ©Ÿèƒ½ ========== //
    
    function handleSearchKeypress(event) {
      if (event.key === 'Enter') {
        searchMembers();
      }
    }
    
    async function searchMembers() {
      const keyword = document.getElementById('searchKeyword').value.trim();
      
      if (!keyword) {
        showMessage('æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
        return;
      }
      
      showLoading(true);
      hideMessage();
      
      try {
        const result = await callApi('searchMembers', { keyword });
        showLoading(false);
        
        if (result.success) {
          displaySearchResults(result.results, result.message);
        } else {
          showMessage('âŒ æ¤œç´¢ã‚¨ãƒ©ãƒ¼: ' + result.error, 'error');
        }
      } catch (error) {
        showLoading(false);
        showMessage('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
      }
    }
    
    async function loadRecentMembers() {
      showLoading(true);
      hideMessage();
      
      try {
        const result = await callApi('getRecentMembers', { count: 20 });
        showLoading(false);
        
        if (result.success) {
          displaySearchResults(result.results, 'æœ€æ–°20ä»¶ã‚’è¡¨ç¤º');
        } else {
          showMessage('âŒ ã‚¨ãƒ©ãƒ¼: ' + result.error, 'error');
        }
      } catch (error) {
        showLoading(false);
        showMessage('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
      }
    }
    
    function displaySearchResults(results, message) {
      const container = document.getElementById('searchResults');
      const listEl = document.getElementById('resultsList');
      const countEl = document.getElementById('resultsCount');
      
      container.style.display = 'block';
      countEl.textContent = message || `${results.length}ä»¶`;
      
      if (!results || results.length === 0) {
        listEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">è©²å½“ã™ã‚‹ä¼šå“¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</div>';
        return;
      }
      
      listEl.innerHTML = results.map((member, index) => {
        const cardCount = member.cardPrintCount || 0;
        const appCount = member.appPrintCount || 0;
//        const cardClass = cardCount > 0 ? 'print-count-has' : 'print-count-zero';
//        const appClass = appCount > 0 ? 'print-count-has' : 'print-count-zero';
/* æ¶ˆå»        
        return `
          <div class="result-item" onclick="selectMember(${index}, this)" data-index="${index}">
            <input type="radio" name="memberSelect" class="result-radio" onclick="event.stopPropagation(); selectMember(${index}, this.closest('.result-item'))">
            <div class="result-info">
              <span class="result-member-id">${escapeHtml(member.memberId)}</span>
              <span class="result-store-name">${escapeHtml(member.storeName)}</span>
              <span class="result-wearer-name">${escapeHtml(member.wearerName || member.representativeName)}</span>
              <span class="result-print-count card-count ${cardClass}">${cardCount}</span>
              <span class="result-print-count app-count ${appClass}">${appCount}</span>
              <span class="result-status ${getStatusClass(member.status)}">${getStatusText(member.status)}</span>
            </div>
          </div>
        `;
*/
        return `
        <div class="result-item" onclick="selectMember(${index}, this)" data-index="${index}">
          <input type="radio" name="memberSelect" class="result-radio" onclick="event.stopPropagation(); selectMember(${index}, this.closest('.result-item'))">
          <div class="result-info">
            <span class="result-member-id">${escapeHtml(member.memberId)}</span>
            <span class="result-store-name">${escapeHtml(member.storeName)}</span>
            <span class="result-wearer-name">${escapeHtml(member.wearerName || member.representativeName)}</span>
            <span class="result-print-count card-count"><input type="checkbox" class="print-checkbox" ${cardCount > 0 ? 'checked' : ''} disabled></span>
            <span class="result-print-count app-count"><input type="checkbox" class="print-checkbox" ${appCount > 0 ? 'checked' : ''} disabled></span>
            <span class="result-status ${getStatusClass(member.status)}">${getStatusText(member.status)}</span>
          </div>
        </div>
      `;
      }).join('');
      
      // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
      window.searchResultsData = results;
      
      // é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
      selectedMemberData = null;
      document.getElementById('selectedMember').classList.remove('show');
      setButtonsEnabled(false);
    }
    
    function selectMember(index, element) {
      // é¸æŠã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
      document.querySelectorAll('.result-item').forEach(item => item.classList.remove('selected'));
      element.classList.add('selected');
      element.querySelector('.result-radio').checked = true;
      
      // ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const member = window.searchResultsData[index];
      selectedMemberData = member;
      
      // é¸æŠä¸­ã®ä¼šå“¡è¡¨ç¤ºã‚’æ›´æ–°
      document.getElementById('selectedMemberId').textContent = member.memberId || '-';
      document.getElementById('selectedStoreName').textContent = member.storeName || '-';
      document.getElementById('selectedWearerName').textContent = member.wearerName || member.representativeName || '-';
//      document.getElementById('selectedCardCount').textContent = member.cardPrintCount || 0;
//      document.getElementById('selectedAppCount').textContent = member.appPrintCount || 0;
      document.getElementById('selectedCardCheck').checked = (member.cardPrintCount || 0) > 0;
      document.getElementById('selectedAppCheck').checked = (member.appPrintCount || 0) > 0;
      document.getElementById('selectedStatus').textContent = getStatusText(member.status);
      document.getElementById('selectedMember').classList.add('show');
      
      // ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
      setButtonsEnabled(true);
    }
    
    function setButtonsEnabled(enabled) {
      document.getElementById('btnDetail').disabled = !enabled;
      document.getElementById('btnCard').disabled = !enabled;
      document.getElementById('btnApplication').disabled = !enabled;
      document.getElementById('btnBoth').disabled = !enabled;
    }
    
    // å°åˆ·å›æ•°è¡¨ç¤ºã‚’æ›´æ–°
/* å‰Šé™¤    
    function updateListPrintCount(index, cardCount, appCount) {
      const items = document.querySelectorAll('.result-item');
      if (items[index]) {
        if (cardCount !== undefined) {
          const cardEl = items[index].querySelector('.card-count');
          if (cardEl) {
            cardEl.textContent = cardCount;
            cardEl.className = 'result-print-count card-count ' + (cardCount > 0 ? 'print-count-has' : 'print-count-zero');
          }
        }
        if (appCount !== undefined) {
          const appEl = items[index].querySelector('.app-count');
          if (appEl) {
            appEl.textContent = appCount;
            appEl.className = 'result-print-count app-count ' + (appCount > 0 ? 'print-count-has' : 'print-count-zero');
          }
        }
      }
    }
*/
function updateListPrintCount(index, cardCount, appCount) {
  const items = document.querySelectorAll('.result-item');
  if (items[index]) {
    if (cardCount !== undefined) {
      const cardCb = items[index].querySelector('.card-count .print-checkbox');
      if (cardCb) cardCb.checked = cardCount > 0;
    }
    if (appCount !== undefined) {
      const appCb = items[index].querySelector('.app-count .print-checkbox');
      if (appCb) appCb.checked = appCount > 0;
    }
  }
}
    
    function getStatusClass(status) {
      if (!status) return 'status-pending';
      const s = status.toUpperCase();
      if (s === 'ACTIVE') return 'status-active';
      if (s === 'INACTIVE') return 'status-inactive';
      return 'status-pending';
    }
    
    function getStatusText(status) {
      if (!status) return 'æœªè¨­å®š';
      const s = status.toUpperCase();
      if (s === 'ACTIVE') return 'æœ‰åŠ¹';
      if (s === 'INACTIVE') return 'ç„¡åŠ¹';
      return status;
    }
    
    function escapeHtml(str) {
      if (!str) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }
    
    // ========== ä¼šå“¡è©³ç´°ã‚’åˆ¥çª“ã§é–‹ã ========== //
    
    function openMemberDetail() {
      if (!selectedMemberData) {
        showMessage('ä¼šå“¡ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
        return;
      }
      
      // ä¼šå“¡è©³ç´°ãƒšãƒ¼ã‚¸ã‚’åˆ¥çª“ã§é–‹ã
      const url = `${MEMBER_DETAIL_URL}?row=${selectedMemberData.rowNumber}&member_id=${encodeURIComponent(selectedMemberData.memberId)}`;
      window.open(url, '_blank', 'width=900,height=800,scrollbars=yes,resizable=yes');
    }
    
    // ========== ã‚«ãƒ¼ãƒ‰ãƒ»ç”³è«‹æ›¸ç”Ÿæˆ ========== //
    
    async function generateCard() {
      if (!selectedMemberData) {
        showMessage('ä¼šå“¡ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
        return;
      }
      
      showLoading(true);
      hideMessage();
      
      try {
        const result = await callApi('generateCardByRow', { rowNumber: selectedMemberData.rowNumber });
        showLoading(false);
        
        if (result.success) {
          // â˜… å°åˆ·å›æ•°ã‚’æ›´æ–°
          const selectedIndex = Array.from(document.querySelectorAll('.result-item')).findIndex(item => item.classList.contains('selected'));
          if (selectedIndex >= 0 && result.cardPrintCount !== undefined) {
            updateListPrintCount(selectedIndex, result.cardPrintCount, undefined);
//å‰Šé™¤            document.getElementById('selectedCardCount').textContent = result.cardPrintCount;
            document.getElementById('selectedCardCheck').checked = true;
          }
          
          showSuccessWithLink(
            `âœ… ã‚«ãƒ¼ãƒ‰ç”Ÿæˆå®Œäº†\n\n` +
            `ä¼šå“¡ç•ªå·: ${result.memberId}\n` +
            `åº—å: ${result.storeName}\n` +
            `ç€ç”¨è€…: ${result.wearerName}\n` +
            `ã‚«ãƒ¼ãƒ‰å°åˆ·å›æ•°: ${result.cardPrintCount || 1}å›ç›®`,
            result.slideUrl,
            'ğŸ« ã‚«ãƒ¼ãƒ‰ã‚’é–‹ã'
          );
        } else {
          showMessage('âŒ ã‚¨ãƒ©ãƒ¼: ' + result.error, 'error');
        }
      } catch (error) {
        showLoading(false);
        showMessage('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
      }
    }
    
    async function generateApplication() {
      if (!selectedMemberData) {
        showMessage('ä¼šå“¡ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
        return;
      }
      
      showLoading(true);
      hideMessage();
      
      try {
        const result = await callApi('generateApplicationFormByRow', { rowNumber: selectedMemberData.rowNumber });
        showLoading(false);
        
        if (result.success) {
          // â˜… å°åˆ·å›æ•°ã‚’æ›´æ–°
          const selectedIndex = Array.from(document.querySelectorAll('.result-item')).findIndex(item => item.classList.contains('selected'));
          if (selectedIndex >= 0 && result.appPrintCount !== undefined) {
            updateListPrintCount(selectedIndex, undefined, result.appPrintCount);
//            document.getElementById('selectedAppCount').textContent = result.appPrintCount;
            document.getElementById('selectedAppCheck').checked = true;
          }
          
          showSuccessWithLink(
            `âœ… ç”³è«‹æ›¸ç”Ÿæˆå®Œäº†\n\n` +
            `ä¼šå“¡ç•ªå·: ${result.memberId}\n` +
            `åº—å: ${result.storeName}\n` +
            `ç”³è«‹æ›¸å°åˆ·å›æ•°: ${result.appPrintCount || 1}å›ç›®`,
            result.slideUrl,
            'ğŸ“‹ ç”³è«‹æ›¸ã‚’é–‹ã'
          );
        } else {
          showMessage('âŒ ã‚¨ãƒ©ãƒ¼: ' + result.error, 'error');
        }
      } catch (error) {
        showLoading(false);
        showMessage('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
      }
    }
    
    async function generateBoth() {
      if (!selectedMemberData) {
        showMessage('ä¼šå“¡ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
        return;
      }
      
      showLoading(true);
      hideMessage();
      
      try {
        const rowNumber = selectedMemberData.rowNumber;
        
        // ç”³è«‹æ›¸ã¨ã‚«ãƒ¼ãƒ‰ã‚’ä¸¦åˆ—ã§ç”Ÿæˆ
        const [appResult, cardResult] = await Promise.all([
          callApi('generateApplicationFormByRow', { rowNumber }),
          callApi('generateCardByRow', { rowNumber })
        ]);
        
        showLoading(false);
        
        if (appResult.success && cardResult.success) {
          // â˜… å°åˆ·å›æ•°ã‚’æ›´æ–°
          const selectedIndex = Array.from(document.querySelectorAll('.result-item')).findIndex(item => item.classList.contains('selected'));
          if (selectedIndex >= 0) {
            updateListPrintCount(selectedIndex, cardResult.cardPrintCount, appResult.appPrintCount);
/* å‰Šé™¤    
            if (cardResult.cardPrintCount !== undefined) {
              document.getElementById('selectedCardCount').textContent = cardResult.cardPrintCount;
            }
            if (appResult.appPrintCount !== undefined) {
              document.getElementById('selectedAppCount').textContent = appResult.appPrintCount;
            }
  */
            // å¤‰æ›´å¾Œ
if (cardResult.cardPrintCount !== undefined) {
  document.getElementById('selectedCardCheck').checked = true;
}
if (appResult.appPrintCount !== undefined) {
  document.getElementById('selectedAppCheck').checked = true;
}
          }
          
          showSuccessWithLinks(
            `âœ… ç”³è«‹æ›¸ï¼‹ã‚«ãƒ¼ãƒ‰ç”Ÿæˆå®Œäº†\n\nä¼šå“¡ç•ªå·: ${appResult.memberId}\nã‚«ãƒ¼ãƒ‰å°åˆ·: ${cardResult.cardPrintCount || 1}å›ç›® / ç”³è«‹æ›¸å°åˆ·: ${appResult.appPrintCount || 1}å›ç›®`,
            [
              { url: appResult.slideUrl, label: 'ğŸ“‹ ç”³è«‹æ›¸ã‚’é–‹ã' },
              { url: cardResult.slideUrl, label: 'ğŸ« ã‚«ãƒ¼ãƒ‰ã‚’é–‹ã' }
            ]
          );
        } else {
          const errors = [];
          if (!appResult.success) errors.push('ç”³è«‹æ›¸: ' + appResult.error);
          if (!cardResult.success) errors.push('ã‚«ãƒ¼ãƒ‰: ' + cardResult.error);
          showMessage('âŒ ã‚¨ãƒ©ãƒ¼:\n' + errors.join('\n'), 'error');
        }
      } catch (error) {
        showLoading(false);
        showMessage('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
      }
    }
    
    // ========== ä¸€æ‹¬å‡¦ç† ========== //
    
    async function generateTestCard() {
      showLoading(true);
      hideMessage();
      
      try {
        const result = await callApi('generateTestCard');
        showLoading(false);
        
        if (result.success) {
          showSuccessWithLink(
            `âœ… ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰ç”Ÿæˆå®Œäº†\n\n` +
            `ä¼šå“¡ç•ªå·: ${result.memberId}\n` +
            `åº—å: ${result.storeName}\n` +
            `ç€ç”¨è€…: ${result.wearerName}`,
            result.slideUrl,
            'ğŸ« ãƒ†ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰ã‚’é–‹ã'
          );
        } else {
          showMessage('âŒ ã‚¨ãƒ©ãƒ¼: ' + result.error, 'error');
        }
      } catch (error) {
        showLoading(false);
        showMessage('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
      }
    }
    
    async function generateAllCards() {
      if (!confirm('å…¨ãƒ‡ãƒ¼ã‚¿ã®ã‚«ãƒ¼ãƒ‰ã‚’ä¸€æ‹¬ç”Ÿæˆã—ã¾ã™ã‹ï¼Ÿ\næ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚')) {
        return;
      }
      
      showLoading(true);
      hideMessage();
      
      try {
        const result = await callApi('generateAllCards');
        showLoading(false);
        
        if (result.success) {
          showMessage(
            `âœ… ä¸€æ‹¬ç”Ÿæˆå®Œäº†\n\næˆåŠŸ: ${result.successCount}ä»¶\nã‚¨ãƒ©ãƒ¼: ${result.errorCount}ä»¶`,
            'success'
          );
        } else {
          showMessage('âŒ ã‚¨ãƒ©ãƒ¼: ' + result.error, 'error');
        }
      } catch (error) {
        showLoading(false);
        showMessage('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
      }
    }
    
    async function generateAllApplications() {
      if (!confirm('å…¨ãƒ‡ãƒ¼ã‚¿ã®ç”³è«‹æ›¸ã‚’ä¸€æ‹¬ç”Ÿæˆã—ã¾ã™ã‹ï¼Ÿ\næ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚')) {
        return;
      }
      
      showLoading(true);
      hideMessage();
      
      try {
        const result = await callApi('generateAllApplicationForms');
        showLoading(false);
        
        if (result.success) {
          showMessage(
            `âœ… ä¸€æ‹¬ç”Ÿæˆå®Œäº†\n\næˆåŠŸ: ${result.successCount}ä»¶\nã‚¨ãƒ©ãƒ¼: ${result.errorCount}ä»¶`,
            'success'
          );
        } else {
          showMessage('âŒ ã‚¨ãƒ©ãƒ¼: ' + result.error, 'error');
        }
      } catch (error) {
        showLoading(false);
        showMessage('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
      }
    }
    
    // ========== UI ãƒ˜ãƒ«ãƒ‘ãƒ¼ ========== //
    
    function showLoading(show) {
      document.getElementById('loading').style.display = show ? 'block' : 'none';
    }
    
    function showMessage(text, type) {
      const messageEl = document.getElementById('message');
      messageEl.textContent = text;
      messageEl.className = 'message ' + type;
      messageEl.style.display = 'block';
    }
    
    function hideMessage() {
      document.getElementById('message').style.display = 'none';
    }
    
    function showSuccessWithLink(text, url, linkLabel) {
      const messageEl = document.getElementById('message');
      messageEl.innerHTML = '';
      messageEl.className = 'message success';
      
      const textNode = document.createElement('div');
      textNode.style.whiteSpace = 'pre-line';
      textNode.textContent = text;
      messageEl.appendChild(textNode);
      
      const link = document.createElement('div');
      link.className = 'result-link';
      link.innerHTML = `<a href="${url}" target="_blank">${linkLabel}</a>`;
      messageEl.appendChild(link);
      
      messageEl.style.display = 'block';
    }
    
    function showSuccessWithLinks(text, links) {
      const messageEl = document.getElementById('message');
      messageEl.innerHTML = '';
      messageEl.className = 'message success';
      
      const textNode = document.createElement('div');
      textNode.style.whiteSpace = 'pre-line';
      textNode.textContent = text;
      messageEl.appendChild(textNode);
      
      links.forEach(function(linkInfo) {
        const link = document.createElement('div');
        link.className = 'result-link';
        link.innerHTML = `<a href="${linkInfo.url}" target="_blank">${linkInfo.label}</a>`;
        messageEl.appendChild(link);
      });
      
      messageEl.style.display = 'block';
    }
    
    // ========== åˆæœŸåŒ– ========== //
    
    function initializePage() {
      // æœ€æ–°20ä»¶ã‚’è‡ªå‹•ãƒ­ãƒ¼ãƒ‰
      loadRecentMembers();
    }
    
    window.onload = function() {
      // èªè¨¼ãƒã‚§ãƒƒã‚¯
      if (!checkAuthentication()) {
        return; // èªè¨¼ã•ã‚Œã¦ã„ãªã„å ´åˆã¯åˆæœŸåŒ–ã‚’ä¸­æ­¢
      }
      initializePage();
    };
  </script>
</body>
</html>
